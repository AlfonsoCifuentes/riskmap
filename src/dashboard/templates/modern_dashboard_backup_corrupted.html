{% extends "base_navigation.html" %}

{% block title %}An√°lisis de Noticias - Stratosight{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/article_cards.css') }}">
<style>
    :root {
        --bg-primary: linear-gradient(180deg, #0a0f2c 0%, #1a2040 40%, #2a3558 80%, #3a4a70 100%);
        --bg-secondary: #141824;
        --text-primary: #e8eaed;
        --text-secondary: #b0b8c4;
        --accent-cyan: #00d4ff;
        --accent-glow: 0 0 15px rgba(0, 212, 255, 0.4), 0 0 25px rgba(0, 212, 255, 0.2);
        --border-color: rgba(255, 255, 255, 0.1);
    }

    html, body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: #1a237e;
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        position: relative;
    }

    /* News Analysis Dashboard Styles - Responsive y Mobile-First */
    .news-dashboard {
        padding: 0;
        max-width: none;
        margin: 0;
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        min-height: calc(100vh - 80px);
        background: rgba(10, 15, 44, 0.08);
        backdrop-filter: blur(2px);
        gap: 0;
        width: 100vw;
    }
    
    .dashboard-content {
        max-width: 96%;
        margin: 0 auto;
        padding: 0 20px;
        width: 100%;
        box-sizing: border-box;
    }
    
    /* Header and Stats Container */
    .header-stats-container {
        width: 100vw;
        position: relative;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
        margin-bottom: -80px;
        top: -80px;
        z-index: 0;
        background: transparent;
        border-radius: 0;
    }
    
    .page-header {
        text-align: center;
        margin: 0;
        color: #fff;
        padding: 180px 0 100px 0;
        width: 100%;
        position: relative;
        background: linear-gradient(135deg, rgba(26, 32, 64, 0.75) 0%, rgba(16, 24, 48, 0.8) 50%, rgba(20, 28, 56, 0.75) 100%);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
    }
    
    .page-title {
        font-family: 'Orbitron', monospace;
        font-size: clamp(1.5rem, 6vw, 4rem);
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #00d4ff 0%, #00a3cc 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        width: 75%;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.2;
        word-wrap: break-word;
        hyphens: auto;
    }
    
    .page-subtitle {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 20px;
    }

    /* Stats Cards - Responsive Grid */
    .news-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0;
        margin: 0;
        width: 100%;
        position: relative;
    }
    
    .news-stat-card {
        background: transparent;
        border: none;
        border-radius: 0;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(3px);
        box-shadow: none;
        border-right: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .news-stat-card:last-child {
        border-right: none;
    }
    
    .news-stat-card:nth-child(1) {
        background: linear-gradient(135deg, rgba(0, 119, 255, 0.4) 0%, rgba(30, 144, 255, 0.35) 100%);
    }
    
    .news-stat-card:nth-child(2) {
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.45) 0%, rgba(239, 68, 68, 0.4) 100%);
    }
    
    .news-stat-card:nth-child(3) {
        background: linear-gradient(135deg, rgba(70, 234, 215, 0.4) 0%, rgba(45, 212, 191, 0.35) 100%);
    }
    
    .news-stat-card:nth-child(4) {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.4) 0%, rgba(37, 99, 235, 0.35) 100%);
    }
    
    .news-stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }
    
    .news-stat-card:nth-child(1):hover {
        background: linear-gradient(135deg, rgba(0, 119, 255, 0.6) 0%, rgba(30, 144, 255, 0.5) 100%);
    }
    
    .news-stat-card:nth-child(2):hover {
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.65) 0%, rgba(239, 68, 68, 0.55) 100%);
    }
    
    .news-stat-card:nth-child(3):hover {
        background: linear-gradient(135deg, rgba(70, 234, 215, 0.6) 0%, rgba(45, 212, 191, 0.5) 100%);
    }
    
    .news-stat-card:nth-child(4):hover {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.6) 0%, rgba(37, 99, 235, 0.5) 100%);
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        margin: 0 auto 15px;
        background: linear-gradient(135deg, #00d4ff 0%, #00a3cc 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        color: #fff;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 5px;
        font-family: 'Orbitron', monospace;
    }
    
    .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Section styling - Mobile-First */
    .news-section {
        background: rgba(26, 32, 64, 0.7);
        border: 1px solid rgba(70, 234, 215, 0.3);
        border-radius: 12px;
        padding: 20px;
        backdrop-filter: blur(15px);
        margin-bottom: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .section-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
        gap: 15px;
    }
    
    .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
    }
    
    .btn-control {
        flex: 1 1 auto;
        max-width: 140px;
        min-width: 80px;
        text-align: center;
        padding: 8px 12px;
        font-size: 0.8rem;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-control:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
    }

    .btn-control.active {
        background: rgba(70, 234, 215, 0.3);
        border-color: rgba(70, 234, 215, 0.5);
        color: #fff;
    }

    /* High Risk Articles Grid - Responsive */
    .high-risk-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .high-risk-card {
        background: linear-gradient(145deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.08));
        border: 1px solid rgba(239, 68, 68, 0.4);
        border-radius: 12px;
        padding: 15px;
        transition: all 0.3s ease;
        backdrop-filter: blur(15px);
    }
    
    .high-risk-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        border-color: rgba(239, 68, 68, 0.5);
    }
    
    .high-risk-title {
        font-size: 1rem;
        font-weight: 600;
        color: #fff;
        margin-bottom: 8px;
        line-height: 1.3;
    }
    
    .high-risk-description {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.85rem;
        line-height: 1.5;
        margin-bottom: 12px;
    }
    
    .high-risk-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .high-risk-location {
        color: rgba(255, 255, 255, 0.6);
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .high-risk-badge {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
        padding: 3px 6px;
        border-radius: 4px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.65rem;
    }

    /* Latest Articles - Full width cards - Mobile-First */
    .latest-articles-grid {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .latest-article-card {
        background: rgba(26, 32, 64, 0.7);
        border: 1px solid rgba(70, 234, 215, 0.25);
        border-radius: 12px;
        padding: 15px;
        transition: all 0.3s ease;
        backdrop-filter: blur(15px);
        display: flex;
        flex-direction: column;
        gap: 12px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
    }
    
    .latest-article-card:hover {
        background: rgba(26, 32, 64, 0.85);
        border-color: rgba(70, 234, 215, 0.4);
        transform: translateY(-2px);
    }
    
    .latest-article-content {
        flex: 1;
    }
    
    .latest-article-title {
        font-size: 1rem;
        font-weight: 600;
        color: #fff;
        margin-bottom: 6px;
        line-height: 1.3;
    }
    
    .latest-article-description {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.85rem;
        line-height: 1.5;
        margin-bottom: 8px;
    }
    
    .latest-article-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.6);
    }
    
    .latest-article-meta-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .latest-article-sidebar {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 8px;
    }
    
    .latest-risk-badge {
        padding: 3px 6px;
        border-radius: 4px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.65rem;
    }
    
    .latest-risk-badge.high {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }
    
    .latest-risk-badge.medium {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
    }
    
    .latest-risk-badge.low {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
    }

    /* News Mosaic Section - Dynamic Collage Layout */
    .news-mosaic-section {
        width: 100vw;
        position: relative;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
        padding: 0;
        background: transparent;
        z-index: 1;
    }
    
    .mosaic-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 10;
        display: flex;
        gap: 10px;
    }
    
    .news-mosaic-container {
        display: grid;
        grid-template-columns: repeat(20, 1fr);
        grid-template-rows: repeat(15, 80px);
        gap: 3px;
        width: 100vw;
        min-height: 100vh;
        background: rgba(0, 0, 0, 0.1);
        padding: 0;
    }
    
    /* Mosaic Article Tiles - Irregular Sizes */
    .mosaic-article {
        position: relative;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(2px);
    }
    
    .mosaic-article::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
            135deg,
            rgba(0, 0, 0, 0.2) 0%,
            rgba(0, 0, 0, 0.1) 40%,
            rgba(0, 0, 0, 0.5) 100%
        );
        border-radius: 12px;
        z-index: 1;
    }
    
    .mosaic-article:hover {
        transform: scale(1.03);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        z-index: 5;
    }
    
    .mosaic-article:hover::before {
        background: linear-gradient(
            135deg,
            rgba(0, 0, 0, 0.1) 0%,
            rgba(0, 0, 0, 0.05) 40%,
            rgba(0, 0, 0, 0.4) 100%
        );
    }
    
    /* Irregular size variants based on importance score */
    .mosaic-article.size-hero {
        grid-column: span 8;
        grid-row: span 6;
    }
    
    .mosaic-article.size-large-wide {
        grid-column: span 7;
        grid-row: span 4;
    }
    
    .mosaic-article.size-large-tall {
        grid-column: span 5;
        grid-row: span 5;
    }
    
    .mosaic-article.size-medium-wide {
        grid-column: span 6;
        grid-row: span 3;
    }
    
    .mosaic-article.size-medium-square {
        grid-column: span 4;
        grid-row: span 4;
    }
    
    .mosaic-article.size-medium-tall {
        grid-column: span 3;
        grid-row: span 5;
    }
    
    .mosaic-article.size-small-wide {
        grid-column: span 5;
        grid-row: span 2;
    }
    
    .mosaic-article.size-small-square {
        grid-column: span 3;
        grid-row: span 3;
    }
    
    .mosaic-article.size-small-tall {
        grid-column: span 2;
        grid-row: span 4;
    }
    
    .mosaic-article.size-mini-wide {
        grid-column: span 4;
        grid-row: span 2;
    }
    
    .mosaic-article.size-mini-square {
        grid-column: span 2;
        grid-row: span 2;
    }
    
    .mosaic-article.size-tiny {
        grid-column: span 3;
        grid-row: span 1;
    }
    
    /* Article content overlay with fixed padding */
    .mosaic-content {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 20px;
        z-index: 2;
        color: white;
        background: linear-gradient(
            transparent 0%,
            rgba(0, 0, 0, 0.3) 20%,
            rgba(0, 0, 0, 0.7) 70%,
            rgba(0, 0, 0, 0.9) 100%
        );
        border-radius: 0 0 12px 12px;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
    }
    
    /* Fixed padding for all content sizes */
    .mosaic-article.size-hero .mosaic-content {
        padding: 30px;
        min-height: 120px;
    }
    
    .mosaic-article.size-large-wide .mosaic-content,
    .mosaic-article.size-large-tall .mosaic-content {
        padding: 25px;
        min-height: 100px;
    }
    
    .mosaic-article.size-medium-wide .mosaic-content,
    .mosaic-article.size-medium-square .mosaic-content,
    .mosaic-article.size-medium-tall .mosaic-content {
        padding: 20px;
        min-height: 80px;
    }
    
    .mosaic-article.size-small-wide .mosaic-content,
    .mosaic-article.size-small-square .mosaic-content,
    .mosaic-article.size-small-tall .mosaic-content {
        padding: 15px;
        min-height: 60px;
    }
    
    .mosaic-article.size-mini-wide .mosaic-content,
    .mosaic-article.size-mini-square .mosaic-content {
        padding: 12px;
        min-height: 50px;
    }
    
    .mosaic-article.size-tiny .mosaic-content {
        padding: 10px;
        min-height: 40px;
    }
    
    .mosaic-title {
        font-size: 1rem;
        font-weight: 600;
        line-height: 1.3;
        margin: 0 0 10px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .mosaic-article.size-hero .mosaic-title {
        font-size: 1.8rem;
        margin-bottom: 15px;
        -webkit-line-clamp: 4;
    }
    
    .mosaic-article.size-large-wide .mosaic-title,
    .mosaic-article.size-large-tall .mosaic-title {
        font-size: 1.4rem;
        margin-bottom: 12px;
        -webkit-line-clamp: 3;
    }
    
    .mosaic-article.size-medium-wide .mosaic-title,
    .mosaic-article.size-medium-square .mosaic-title,
    .mosaic-article.size-medium-tall .mosaic-title {
        font-size: 1.1rem;
        margin-bottom: 10px;
        -webkit-line-clamp: 3;
    }
    
    .mosaic-article.size-small-wide .mosaic-title,
    .mosaic-article.size-small-square .mosaic-title,
    .mosaic-article.size-small-tall .mosaic-title {
        font-size: 0.95rem;
        margin-bottom: 8px;
        -webkit-line-clamp: 2;
    }
    
    .mosaic-article.size-mini-wide .mosaic-title,
    .mosaic-article.size-mini-square .mosaic-title {
        font-size: 0.85rem;
        margin-bottom: 6px;
        -webkit-line-clamp: 2;
    }
    
    .mosaic-article.size-tiny .mosaic-title {
        font-size: 0.75rem;
        margin-bottom: 4px;
        -webkit-line-clamp: 1;
    }
    
    .mosaic-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: auto;
    }
    
    .mosaic-location {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.9);
        background: rgba(0, 0, 0, 0.4);
        padding: 6px 10px;
        border-radius: 15px;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .mosaic-risk-badge {
        font-size: 0.65rem;
        font-weight: 700;
        padding: 6px 10px;
        border-radius: 15px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-shadow: none;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .mosaic-risk-badge.hero {
        background: linear-gradient(135deg, #dc2626, #ef4444);
        color: white;
        font-size: 0.8rem;
        padding: 8px 12px;
        box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }
    
    .mosaic-risk-badge.high {
        background: rgba(220, 38, 38, 0.9);
        color: white;
        box-shadow: 0 2px 10px rgba(220, 38, 38, 0.3);
    }
    
    .mosaic-risk-badge.medium {
        background: rgba(245, 158, 11, 0.9);
        color: white;
        box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
    }
    
    .mosaic-risk-badge.low {
        background: rgba(34, 197, 94, 0.9);
        color: white;
        box-shadow: 0 2px 10px rgba(34, 197, 94, 0.3);
    }
    
    /* Loading state */
    .mosaic-loading {
        grid-column: 1 / -1;
        grid-row: 1 / -1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.2rem;
    }
    
    .mosaic-loading i {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #46ead7;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1400px) {
        .news-mosaic-container {
            grid-template-columns: repeat(16, 1fr);
        }
        
        .mosaic-article.size-hero {
            grid-column: span 6;
            grid-row: span 5;
        }
    }
    
    @media (max-width: 1200px) {
        .news-mosaic-container {
            grid-template-columns: repeat(12, 1fr);
        }
        
        .mosaic-article.size-hero {
            grid-column: span 6;
            grid-row: span 4;
        }
        
        .mosaic-article.size-large-wide {
            grid-column: span 5;
            grid-row: span 3;
        }
    }
    
    @media (max-width: 768px) {
        .news-mosaic-container {
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(20, 60px);
        }
        
        .mosaic-article.size-hero {
            grid-column: span 8;
            grid-row: span 4;
        }
        
        .mosaic-article.size-large-wide,
        .mosaic-article.size-large-tall {
            grid-column: span 4;
            grid-row: span 3;
        }
        
        .mosaic-controls {
            position: relative;
            top: auto;
            right: auto;
            margin: 10px;
            justify-content: center;
        }
    }
    
    .featured-article-content {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 24px;
        align-items: start;
    }
    
    .featured-article-image {
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        aspect-ratio: 16/10;
        background: linear-gradient(135deg, rgba(26, 32, 64, 0.8) 0%, rgba(26, 32, 64, 0.9) 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .featured-article-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
        display: block;
    }
    
    .featured-article-image img[src="/static/img/default-news.svg"] {
        width: 80%;
        height: 80%;
        object-fit: contain;
        opacity: 0.8;
    }
    
    .featured-article-image:hover img:not([src="/static/img/default-news.svg"]) {
        transform: scale(1.05);
    }
    
    .image-fallback {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(70, 234, 215, 0.1), rgba(70, 100, 234, 0.1));
        border: 2px dashed rgba(70, 234, 215, 0.3);
        border-radius: 12px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        animation: subtlePulse 2s ease-in-out infinite;
    }

    @keyframes subtlePulse {
        0%, 100% { transform: scale(1); opacity: 0.9; }
        50% { transform: scale(1.02); opacity: 1; }
    }

    .fallback-content {
        text-align: center;
        padding: 20px;
        color: rgba(255, 255, 255, 0.8);
    }

    .fallback-content i {
        display: block;
        margin-bottom: 10px;
        filter: drop-shadow(0 0 10px rgba(70, 234, 215, 0.3));
    }
    
    .featured-image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
            135deg,
            transparent 0%,
            rgba(0, 0, 0, 0.2) 40%,
            rgba(0, 0, 0, 0.6) 100%
        );
        display: flex;
        align-items: flex-end;
        padding: 16px;
    }
    
    .featured-risk-badge {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }
    
    .featured-article-text {
        flex: 1;
    }
    
    .featured-article-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 12px;
        line-height: 1.3;
    }
    
    .featured-article-description {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 15px;
    }
    
    .featured-article-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
        font-size: 0.85rem;
    }
    
    .featured-meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .featured-article-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #00d4ff 0%, #00a3cc 100%);
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
    }
    
    .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        padding: 10px 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
    }
    
    .btn-secondary:hover {
        background: rgba(70, 234, 215, 0.2);
        border-color: rgba(70, 234, 215, 0.4);
        color: #fff;
    }

    /* Map Section - Enhanced and Responsive */
    .map-section-enhanced {
        background: rgba(26, 32, 64, 0.7);
        border: 1px solid rgba(70, 234, 215, 0.3);
        border-radius: 12px;
        padding: 20px;
        backdrop-filter: blur(15px);
        margin-bottom: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .map-container {
        width: 100%;
        height: 400px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, #0a0f2c 0%, #1a2040 50%, #2a3558 100%);
        border-radius: 8px;
        border: 1px solid rgba(70, 234, 215, 0.2);
        box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
    }

    /* AI Analysis Article Styles */
    .ai-article-container {
        padding: 0;
    }
    
    .ai-loading-state {
        text-align: center;
        padding: 40px 20px;
        color: rgba(255,255,255,0.7);
    }
    
    .ai-article-content {
        background: rgba(26, 32, 64, 0.7);
        border: 1px solid rgba(70, 234, 215, 0.25);
        border-radius: 8px;
        padding: 30px;
        font-family: 'Inter', serif;
        line-height: 1.7;
        color: #e8eaed;
        backdrop-filter: blur(15px);
        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.3);
    }
    
    .ai-article-header {
        border-bottom: 2px solid rgba(70, 234, 215, 0.3);
        padding-bottom: 20px;
        margin-bottom: 25px;
    }
    
    .ai-article-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.6rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 12px;
        line-height: 1.3;
    }
    
    .ai-article-subtitle {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.8);
        font-style: italic;
        margin-bottom: 15px;
    }
    
    .ai-article-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 10px;
    }
    
    .ai-meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .ai-article-body {
        font-size: 1rem;
        line-height: 1.8;
    }
    
    .ai-article-section {
        margin-bottom: 25px;
    }
    
    .ai-section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #00d4ff;
        margin-bottom: 12px;
        padding-left: 15px;
        border-left: 3px solid #00d4ff;
    }
    
    .ai-article-paragraph {
        margin-bottom: 15px;
        text-align: justify;
    }
    
    .ai-highlight {
        background: rgba(70, 234, 215, 0.2);
        padding: 2px 4px;
        border-radius: 3px;
        color: #fff;
        font-weight: 500;
    }
    
    .ai-quote {
        border-left: 4px solid #00d4ff;
        padding: 15px 20px;
        margin: 20px 0;
        background: rgba(0, 212, 255, 0.1);
        font-style: italic;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .ai-article-footer {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
        text-align: center;
    }
    
    .ai-byline {
        font-style: italic;
        color: rgba(255, 255, 255, 0.7);
    }

    /* Media Queries para mejorar la experiencia m√≥vil */
    @media (min-width: 768px) {
        .page-title {
            font-size: clamp(2.5rem, 8vw, 5rem);
            width: 75%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .page-subtitle {
            font-size: 1.2rem;
            width: 75%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .news-dashboard {
            padding: 0;
        }
        
        .dashboard-content {
            padding: 0 30px;
        }
        
        .featured-article-content {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .featured-article-image {
            aspect-ratio: 16/9;
        }
    }
    
    /* Tablet and Desktop */
    @media (min-width: 768px) {
        .page-title {
            font-size: 2.5rem;
        }
        
        .page-subtitle {
            font-size: 1.2rem;
        }
        
        .news-dashboard {
            padding: 0;
        }
        
        .dashboard-content {
            padding: 0 30px;
        }
        
        .featured-article-content {
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }
        
        .featured-article-image {
            aspect-ratio: 16/10;
        }
        
        .latest-article-card {
            flex-direction: row;
            align-items: center;
        }
        
        .latest-article-sidebar {
            align-items: flex-end;
            flex-direction: row;
            justify-content: space-between;
        }
        
        .map-container {
            height: 500px;
        }
        
        .news-stats {
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }
        
        .stat-value {
            font-size: 2.5rem;
        }
    }

    @media (max-width: 767px) {
        .page-title {
            font-size: clamp(1.2rem, 8vw, 2.5rem);
            width: 90%;
            white-space: normal;
            word-break: break-word;
            line-height: 1.3;
        }
        
        .page-subtitle {
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .section-controls {
            width: 100%;
            justify-content: flex-start;
        }
        
        .btn-control {
            font-size: 0.75rem;
            padding: 6px 10px;
            min-width: 70px;
        }
        
        .latest-article-card {
            align-items: flex-start;
        }
        
        .latest-article-sidebar {
            align-items: flex-start;
            flex-direction: row;
            width: 100%;
            justify-content: space-between;
        }
        
        .featured-article-actions {
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .news-dashboard {
            padding: 0;
        }
        
        .dashboard-content {
            padding: 0 15px;
        }
        
        .news-stats {
            grid-template-columns: repeat(2, 1fr);
            gap: 0;
        }
        
        .news-stat-card {
            padding: 15px;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .news-stat-card:nth-child(2n) {
            border-right: none;
        }
        
        .news-stat-card:nth-child(3), .news-stat-card:nth-child(4) {
            border-bottom: none;
        }
        
        .stat-value {
            font-size: 1.8rem;
        }
        
        .high-risk-grid {
            grid-template-columns: 1fr;
        }
    }
    
    @media (min-width: 1200px) {
        .page-title {
            font-size: clamp(3rem, 6vw, 4.5rem);
            width: 75%;
            white-space: nowrap;
        }
        
        .page-subtitle {
            font-size: 1.3rem;
            width: 75%;
        }
        
        .featured-article-content {
            grid-template-columns: 320px 1fr;
            gap: 28px;
        }
        
        .featured-article-image {
            aspect-ratio: 16/10;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header and Stats Container -->
<div class="header-stats-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">üì∞ An√°lisis de Noticias</h1>
        <p class="page-subtitle">
            Monitoreo en tiempo real de noticias geopol√≠ticas con an√°lisis de riesgo y clasificaci√≥n autom√°tica
        </p>
    </div>
    
    <!-- News Statistics -->
    <div class="news-stats">
        <div class="news-stat-card">
            <div class="stat-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <div class="stat-value" id="totalArticles">0</div>
            <div class="stat-label">Total Art√≠culos</div>
        </div>
        
        <div class="news-stat-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-value" id="highRiskEvents">0</div>
            <div class="stat-label">Eventos Alto Riesgo</div>
        </div>
        
        <div class="news-stat-card">
            <div class="stat-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="stat-value" id="processedToday">0</div>
            <div class="stat-label">Procesados Hoy</div>
        </div>
        
        <div class="news-stat-card">
            <div class="stat-icon">
                <i class="fas fa-globe-americas"></i>
            </div>
            <div class="stat-value" id="activeRegions">0</div>
            <div class="stat-label">Regiones Activas</div>
        </div>
    </div>
</div>

<!-- News Analysis Dashboard -->
<div class="news-dashboard">
    <div class="dashboard-content">

    <!-- News Mosaic Section - Dynamic Collage Layout -->
    <div class="news-mosaic-section">
        <div class="mosaic-controls">
            <button class="btn-control" id="refreshMosaic">
                <i class="fas fa-sync-alt"></i> Actualizar Noticias
            </button>
            <button class="btn-control" id="filterMosaic">
                <i class="fas fa-filter"></i> Filtrar
            </button>
        </div>
        
        <div class="news-mosaic-container" id="newsMosaicGrid">
            <!-- Dynamic mosaic articles will be loaded here -->
            <div class="mosaic-loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Cargando mosaico de noticias...</p>
            </div>
        </div>
    </div>

    <!-- Map Section - Enhanced -->
    <div class="map-section-enhanced">
        <div class="section-header">
            <h3 class="section-title">
                <i class="fas fa-map-marked-alt"></i>
                Mapas de An√°lisis Geopol√≠tico
            </h3>
            <div class="section-controls">
                <button class="btn-control active" data-map-type="general">
                    <i class="fas fa-globe"></i> General
                </button>
                <button class="btn-control" data-map-type="conflict_risk">
                    <i class="fas fa-exclamation-triangle"></i> Riesgo Conflicto
                </button>
                <button class="btn-control" data-map-type="historical_conflicts">
                    <i class="fas fa-history"></i> Conflictos Hist√≥ricos
                </button>
                <button class="btn-control" data-map-type="oil">
                    <i class="fas fa-oil-can"></i> Petr√≥leo
                </button>
                <button class="btn-control" data-map-type="energy">
                    <i class="fas fa-bolt"></i> Energ√≠a
                </button>
                <button class="btn-control" data-map-type="supplies">
                    <i class="fas fa-shipping-fast"></i> Suministros
                </button>
                <button class="btn-control" data-map-type="internet_cables">
                    <i class="fas fa-network-wired"></i> Internet
                </button>
                <button class="btn-control" data-map-type="military_bases">
                    <i class="fas fa-shield-alt"></i> Militar
                </button>
                <button class="btn-control" data-map-type="trade_routes">
                    <i class="fas fa-route"></i> Comercio
                </button>
            </div>
            <!-- Map display container -->
            <div class="section-body">
                <div id="map" class="h-96 rounded-lg bg-gray-800/50 border border-gray-700/50"></div>
            </div>
        </div>
        <div class="map-container" id="main-map">
            <i class="fas fa-map" style="font-size: 3rem; opacity: 0.3;"></i>
            <p style="margin-top: 1rem; opacity: 0.6;">Mapa de calor cargando...</p>
        </div>
    </div>

    <!-- Enhanced AI Analysis Section -->
    <div id="aiArticleContent" class="news-section">
        <div class="section-header">
            <h3 class="section-title">
                <i class="fas fa-newspaper"></i>
                La actualidad geopol√≠tica vista por la IA
            </h3>
            <div class="section-controls">
                <button class="btn-control" id="refreshAIAnalysis">
                    <i class="fas fa-sync-alt"></i> Actualizar An√°lisis
                </button>
                <button class="btn-control" id="generateAIReport">
                    <i class="fas fa-file-download"></i> Exportar Art√≠culo
                </button>
            </div>
        </div>
        <div class="section-body">
            <!-- Contenedor para an√°lisis IA avanzado -->
            <div id="aiAnalysisContent" class="ai-article-container">
                <div class="ai-loading-state">
                    <i class="fas fa-edit" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.6; color: #46ead7;"></i>
                    <h4 style="margin-bottom: 10px; color: #fff;">Generando an√°lisis geopol√≠tico...</h4>
                    <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Nuestro periodista de IA est√° preparando un resumen exhaustivo de la actualidad mundial</p>
                    <div class="loading-spinner" style="margin-top: 20px;">
                        <i class="fas fa-spinner fa-spin" style="color: #46ead7; font-size: 1.5rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Charts Section -->
    <div class="news-section">
        <div class="section-header">
            <h3 class="section-title"><i class="fas fa-chart-pie"></i> An√°lisis de Categor√≠as</h3>
        </div>
        <div class="section-body grid grid-cols-1 md:grid-cols-3 gap-6">
            <div id="categoryChart" style="height:300px;"></div>
            <div id="timelineChart" style="height:300px;"></div>
            <div id="sentimentChart" style="height:300px;"></div>
        </div>
    </div>


    </div> <!-- close dashboard-content -->
</div> <!-- close news-dashboard -->
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard loaded, initializing...');
    
    const socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

    socket.on('connect', function() {
        console.log('Connected to Socket.IO');
    });

    socket.on('new_articles', function(data) {
        console.log('Received new articles:', data.articles);
        showNotification(`Nuevos art√≠culos recibidos: ${data.articles.length}`, 'info');
        updateLatestArticlesList(data.articles);
        
        const highRiskArticles = data.articles.filter(a => a.risk_level === 'high');
        if (highRiskArticles.length > 0) {
            updateHighRiskArticlesGrid(highRiskArticles);
        }

        // Also, refresh stats when new articles arrive
        fetch('/api/dashboard/stats')
            .then(response => response.json())
            .then(statsData => {
                updateStats(statsData.stats);
            });
    });

    function updateStats(stats) {
        document.getElementById('totalArticles').textContent = stats.total_articles;
        document.getElementById('highRiskEvents').textContent = stats.high_risk_events;
        document.getElementById('processedToday').textContent = stats.processed_today;
        document.getElementById('activeRegions').textContent = stats.active_regions;
    }

    // Initial data load
    fetch('/api/dashboard/stats')
        .then(response => response.json())
        .then(data => {
            updateStats(data.stats);
            updateMapWithMarkers(data.events);
        })
        .catch(error => {
            console.error('Error loading stats:', error);
        });

    fetch('/api/articles')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(articles => {
            console.log('Articles received:', articles);
            if (Array.isArray(articles)) {
                updateLatestArticlesList(articles);
                const highRiskArticles = articles.filter(a => a.risk_level === 'high');
                updateHighRiskArticlesGrid(highRiskArticles);
            } else {
                console.error('Articles is not an array:', articles);
                updateLatestArticlesList([]);
                updateHighRiskArticlesGrid([]);
            }
        })
        .catch(error => {
            console.error('Error fetching articles:', error);
            showNotification('Error al cargar art√≠culos', 'error');
            updateLatestArticlesList([]);
            updateHighRiskArticlesGrid([]);
        });

    // Map type controls
    document.querySelectorAll('.btn-control[data-map-type]').forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all buttons
            document.querySelectorAll('.btn-control[data-map-type]').forEach(b => b.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            
            const mapType = this.dataset.mapType;
            switchMapType(mapType);
        });
    });
    
    // Load initial data and create mosaic
    loadNewsMosaic();

    // Mosaic controls
    document.getElementById('refreshMosaic').addEventListener('click', function() {
        loadNewsMosaic();
        showNotification('Actualizando mosaico de noticias...', 'info');
    });
    
    document.getElementById('filterMosaic').addEventListener('click', function() {
        filterNewsMosaic();
    });

    // Load AI analysis
    setTimeout(() => {
        loadAIGeopoliticalAnalysis();
    }, 1000);

    // AI Analysis controls
    document.getElementById('refreshAIAnalysis').addEventListener('click', function() {
        loadAIGeopoliticalAnalysis();
        showNotification('Generando nuevo an√°lisis geopol√≠tico...', 'info');
    });
    
    document.getElementById('generateAIReport').addEventListener('click', function() {
        exportAIArticle();
    });
});

function switchMapType(mapType) {
    console.log(`Switching to ${mapType} map type`);
    
    // Show loading indicator
    showMapLoading();
    
    // Update map title based on type
    updateMapTitle(mapType);
    
    // Load the specific map type
    loadHeatmapWithType(mapType);
}

function updateMapTitle(mapType) {
    const titleElement = document.querySelector('.map-section-enhanced .section-title');
    const typeNames = {
        'general': 'Mapa de An√°lisis General',
        'conflict_risk': 'Mapa de Riesgo de Conflicto',
        'historical_conflicts': 'Mapa de Conflictos Hist√≥ricos',
        'oil': 'Mapa de Instalaciones Petrol√≠feras',
        'energy': 'Mapa de Infraestructura Energ√©tica',
        'supplies': 'Mapa de Cadenas de Suministro',
        'internet_cables': 'Mapa de Cables de Internet',
        'military_bases': 'Mapa de Bases Militares',
        'trade_routes': 'Mapa de Rutas Comerciales'
    };
    
    if (titleElement && typeNames[mapType]) {
        titleElement.innerHTML = `<i class="fas fa-map-marked-alt"></i> ${typeNames[mapType]}`;
    }
}

function loadHeatmapWithType(mapType) {
    const url = `/api/events/heatmap?type=${mapType}`;
    
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log(`${mapType} map data:`, data);
            updateMapWithHeatmap(data, mapType);
            hideMapLoading();
        })
        .catch(error => {
            console.error(`Error loading ${mapType} map:`, error);
            showMapError(`Error al cargar el mapa de ${mapType}`);
            hideMapLoading();
        });
}

function updateMapWithHeatmap(data, mapType = 'general') {
    console.log(`Updating map with heatmap data for ${mapType}:`, data);
    
    const mapContainer = document.getElementById('main-map');
    const typeColors = {
        'general': '#3498db',
        'conflict_risk': '#e74c3c',
        'historical_conflicts': '#8b0000',
        'oil': '#f39c12',
        'energy': '#f1c40f',
        'supplies': '#2ecc71',
        'internet_cables': '#9b59b6',
        'military_bases': '#34495e',
        'trade_routes': '#16a085'
    };
    
    const typeIcons = {
        'general': 'fas fa-globe',
        'conflict_risk': 'fas fa-exclamation-triangle',
        'historical_conflicts': 'fas fa-history',
        'oil': 'fas fa-oil-can',
        'energy': 'fas fa-bolt',
        'supplies': 'fas fa-shipping-fast',
        'internet_cables': 'fas fa-network-wired',
        'military_bases': 'fas fa-shield-alt',
        'trade_routes': 'fas fa-route'
    };
    
    const color = typeColors[mapType] || '#3498db';
    const icon = typeIcons[mapType] || 'fas fa-globe';
    
    mapContainer.innerHTML = `
        <i class="${icon}" style="font-size: 3rem; opacity: 0.6; color: ${color};"></i>
        <p style="margin-top: 1rem; opacity: 0.8;">Mapa actualizado con ${data.length || 0} puntos</p>
        <div style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.7;">
            Tipo: ${mapType.replace('_', ' ').toUpperCase()}
        </div>
    `;
    
    showNotification(`Mapa de ${mapType.replace('_', ' ')} actualizado`, 'success');
}

function showMapError(message) {
    const mapContainer = document.getElementById('main-map');
    mapContainer.innerHTML = `
        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; opacity: 0.6; color: #e74c3c;"></i>
        <p style="margin-top: 1rem; opacity: 0.8; color: #e74c3c;">${message}</p>
        <div style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.7;">
            Intenta seleccionar otro tipo de mapa
        </div>
    `;
}

function updateMapWithMarkers(events) {
    console.log('Updating map with markers:', events);
    const mapContainer = document.getElementById('main-map');
    mapContainer.innerHTML = `
        <i class="fas fa-map-marker-alt" style="font-size: 3rem; opacity: 0.6; color: #46ead7;"></i>
        <p style="margin-top: 1rem; opacity: 0.8;">Marcadores actualizados con ${events?.length || 0} eventos</p>
    `;
    showNotification('Marcadores actualizados', 'success');
}

function showMapLoading() {
    const mapContainer = document.getElementById('main-map');
    if (mapContainer) {
        mapContainer.innerHTML = `
            <i class="fas fa-spinner fa-spin" style="font-size: 3rem; opacity: 0.6;"></i>
            <p style="margin-top: 1rem; opacity: 0.6;">Cargando...</p>
        `;
    }
}

function hideMapLoading() {
    // Map loading is handled by the update functions
}

function refreshHighRiskArticles() {
    console.log('Refreshing high risk articles...');
    showNotification('Actualizando art√≠culos de alto riesgo...', 'info');
    
    fetch('/api/articles/high-risk?limit=10')
        .then(response => response.json())
        .then(articles => {
            updateHighRiskArticlesGrid(articles);
            showNotification('Art√≠culos de alto riesgo actualizados', 'success');
        })
        .catch(error => {
            console.error('Error refreshing high risk articles:', error);
            showNotification('Error al actualizar art√≠culos', 'error');
        });
}

function filterHighRiskArticles() {
    const filterOptions = ['high', 'medium', 'all'];
    const filter = prompt(`Filtrar por nivel de riesgo:\n- high (solo alto riesgo)\n- medium (medio y alto)\n- all (todos)\n\nIngrese su opci√≥n:`);
    
    if (filter && filterOptions.includes(filter.toLowerCase())) {
        console.log(`Filtering high risk articles by: ${filter}`);
        
        const articles = document.querySelectorAll('#highRiskArticlesGrid .high-risk-card');
        articles.forEach(article => {
            const riskLevel = article.dataset.riskLevel;
            
            if (filter === 'all' || 
                (filter === 'high' && riskLevel === 'high') ||
                (filter === 'medium' && (riskLevel === 'high' || riskLevel === 'medium'))) {
                article.style.display = 'block';
            } else {
                article.style.display = 'none';
            }
        });
        
        showNotification(`Filtro aplicado: ${filter}`, 'success');
    }
}

function refreshLatestArticles() {
    console.log('Refreshing latest articles...');
    showNotification('Actualizando √∫ltimos art√≠culos...', 'info');
    
    fetch('/api/articles/latest?limit=15')
        .then(response => response.json())
        .then(articles => {
            updateLatestArticlesList(articles);
            showNotification('√öltimos art√≠culos actualizados', 'success');
        })
        .catch(error => {
            console.error('Error refreshing latest articles:', error);
            showNotification('Error al actualizar art√≠culos', 'error');
        });
}

function filterLatestArticles() {
    const languages = ['es', 'en', 'fr', 'de', 'ru', 'zh', 'ar'];
    const language = prompt(`Filtrar por idioma:\n${languages.join(', ')}\n\nIngrese el c√≥digo de idioma o 'all' para todos:`);
    
    if (language) {
        console.log(`Filtering latest articles by language: ${language}`);
        
        const articles = document.querySelectorAll('#latestArticlesList .latest-article-card');
        articles.forEach(article => {
            const articleLang = article.dataset.language;
            
            if (language === 'all' || articleLang === language) {
                article.style.display = 'flex';
            } else {
                article.style.display = 'none';
            }
        });
        
        showNotification(`Filtro de idioma aplicado: ${language}`, 'success');
    }
}

function showFeaturedAnalysis() {
    console.log('Showing featured article analysis...');
    
    // Get featured article data
    fetch('/api/articles/featured')
        .then(response => response.json())
        .then(article => {
            if (article && article.id !== 0) {
                openAnalysisWindow(article);
            } else {
                showNotification('No hay art√≠culo destacado disponible', 'warning');
            }
        })
        .catch(error => {
            console.error('Error getting featured article:', error);
            showNotification('Error al obtener an√°lisis del art√≠culo', 'error');
        });
}

function openAnalysisWindow(article) {
    const analysisWindow = window.open('', '_blank', 'width=800,height=600');
    analysisWindow.document.write(`
        <html>
        <head>
            <title>An√°lisis: ${article.title}</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: #fff; }
                .header { border-bottom: 2px solid #667eea; padding-bottom: 15px; margin-bottom: 20px; }
                .title { color: #46ead7; font-size: 1.5rem; margin-bottom: 10px; }
                .meta { color: #aaa; font-size: 0.9rem; }
                .content { line-height: 1.6; }
                .section { margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; }
            </style>
        </head>
        <body>
            <div class="header">
                <h1 class="title">${article.title}</h1>
                <div class="meta">
                    <strong>Ubicaci√≥n:</strong> ${article.location || article.country || 'Global'} | 
                    <strong>Nivel de Riesgo:</strong> ${article.risk_level || 'N/A'} | 
                    <strong>Fuente:</strong> ${article.source || 'Desconocida'}
                </div>
            </div>
            <div class="section">
                <h3>Descripci√≥n</h3>
                <p>${article.content || article.summary || 'No hay descripci√≥n disponible'}</p>
            </div>
            <div class="section">
                <h3>An√°lisis de Riesgo</h3>
                <p>Este art√≠culo ha sido clasificado como <strong>${article.risk_level || 'N/A'}</strong> basado en el an√°lisis autom√°tico de contenido y factores geopol√≠ticos.</p>
            </div>
            <div class="section">
                <h3>Enlace Original</h3>
                <a href="${article.url || article.source_url || '#'}" target="_blank" style="color: #46ead7;">${article.url || article.source_url || 'No disponible'}</a>
            </div>
        </body>
        </html>
    `);
}

// Enhanced functions for styling
function updateHighRiskArticlesGrid(articles) {
    const grid = document.getElementById('highRiskArticlesGrid');
    if (!grid) return;
    
    if (!Array.isArray(articles)) {
        console.error('updateHighRiskArticlesGrid: articles is not an array:', articles);
        grid.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 2rem; grid-column: 1 / -1;">No hay art√≠culos de alto riesgo disponibles</p>';
        return;
    }
    
    if (articles.length === 0) {
        grid.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 2rem; grid-column: 1 / -1;">No hay art√≠culos de alto riesgo disponibles</p>';
        return;
    }
    
    const highRiskArticles = articles.filter(a => a.risk_level === 'high').slice(0, 6);
    
    if (highRiskArticles.length === 0) {
        grid.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 2rem; grid-column: 1 / -1;">No hay art√≠culos de alto riesgo disponibles</p>';
        return;
    }
    
    grid.innerHTML = highRiskArticles.map(article => `
        <div class="high-risk-card" data-risk-level="${article.risk_level || 'high'}">
            <h4 class="high-risk-title">${(article.title || 'Sin t√≠tulo').substring(0, 80)}${(article.title || '').length > 80 ? '...' : ''}</h4>
            <p class="high-risk-description">${(article.content || article.summary || 'Sin descripci√≥n disponible').substring(0, 120)}${(article.content || article.summary || '').length > 120 ? '...' : ''}</p>
            <div class="high-risk-meta">
                <div class="high-risk-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${article.country || article.location || 'Global'}</span>
                </div>
                <div class="high-risk-badge">ALTO RIESGO</div>
            </div>
        </div>
    `).join('');
}

function updateLatestArticlesList(articles) {
    const list = document.getElementById('latestArticlesList');
    if (!list) return;
    
    if (!Array.isArray(articles)) {
        console.error('updateLatestArticlesList: articles is not an array:', articles);
        list.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 2rem;">No hay art√≠culos disponibles</p>';
        return;
    }
    
    if (articles.length === 0) {
        list.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 2rem;">No hay art√≠culos disponibles</p>';
        return;
    }
    
    const latestArticles = articles.slice(0, 10);
    
    list.innerHTML = latestArticles.map(article => `
        <div class="latest-article-card" data-language="${article.language || 'es'}" data-risk-level="${article.risk_level || 'medium'}">
            <div class="latest-article-content">
                <h5 class="latest-article-title">${article.title || 'Sin t√≠tulo'}</h5>
                <p class="latest-article-description">${(article.content || article.summary || 'Sin descripci√≥n disponible').substring(0, 200)}${(article.content || article.summary || '').length > 200 ? '...' : ''}</p>
                <div class="latest-article-meta">
                    <div class="latest-article-meta-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${article.country || article.location || 'Global'}</span>
                    </div>
                    <div class="latest-article-meta-item">
                        <i class="fas fa-clock"></i>
                        <span>${article.created_at ? new Date(article.created_at).toLocaleDateString() : 'Fecha no disponible'}</span>
                    </div>
                    <div class="latest-article-meta-item">
                        <i class="fas fa-globe"></i>
                        <span>${article.source || 'Fuente desconocida'}</span>
                    </div>
                </div>
            </div>
            <div class="latest-article-sidebar">
                <span class="latest-risk-badge ${article.risk_level || 'medium'}">${(article.risk_level || 'medium').toUpperCase()}</span>
                ${article.source_url || article.url ? `<a href="${article.source_url || article.url}" target="_blank" style="color: #46ead7; text-decoration: none; font-size: 0.8rem;"><i class="fas fa-external-link-alt"></i> Ver fuente</a>` : ''}
            </div>
        </div>
    `).join('');
}

// Load and display featured article
function loadFeaturedArticle() {
    console.log('Loading featured article...');
    
    fetch('/api/articles/featured')
        .then(response => response.json())
        .then(article => {
            console.log('Featured article response:', article);
            if (article && article.id !== 0) {
                updateFeaturedArticle(article);
            } else {
                console.log('No featured article found, trying high-risk articles...');
                // Try to get the highest risk article
                return fetch('/api/articles/high-risk?limit=1')
                    .then(response => response.json())
                    .then(articles => {
                        console.log('High-risk articles response:', articles);
                        if (articles && articles.length > 0) {
                            updateFeaturedArticle(articles[0]);
                        } else {
                            console.log('No high-risk articles found, trying latest articles...');
                            // Fallback to latest articles
                            return fetch('/api/articles?limit=1')
                                .then(response => response.json())
                                .then(latestArticles => {
                                    console.log('Latest articles response:', latestArticles);
                                    if (latestArticles && latestArticles.length > 0) {
                                        updateFeaturedArticle(latestArticles[0]);
                                    } else {
                                        console.log('No articles found at all');
                                        showNotification('No hay art√≠culos disponibles', 'warning');
                                    }
                                });
                        }
                    });
            }
        })
        .catch(error => {
            console.error('Error loading featured article:', error);
            showNotification('Error al cargar art√≠culo destacado', 'error');
        });
}

function updateFeaturedArticle(article) {
    console.log('Updating featured article:', article);
    
    // Update image with better error handling
    const featuredImage = document.getElementById('featuredImage');
    if (featuredImage) {
        // Try different image sources with extensive logging
        const imageUrl = article.image_url || article.image || article.thumbnail_url || 
                        article.urlToImage || article.image_link || article.media_url ||
                        article.thumbnail || article.picture_url || article.photo_url;
        
        console.log('Image URL candidates:', {
            image_url: article.image_url,
            image: article.image,
            thumbnail_url: article.thumbnail_url,
            urlToImage: article.urlToImage,
            image_link: article.image_link,
            media_url: article.media_url,
            thumbnail: article.thumbnail,
            picture_url: article.picture_url,
            photo_url: article.photo_url,
            selected: imageUrl
        });
        
        if (imageUrl && imageUrl !== '' && imageUrl !== 'null' && imageUrl !== null) {
            console.log('Loading image from:', imageUrl);
            
            // Show loading state
            featuredImage.style.opacity = '0.5';
            featuredImage.parentElement.style.background = 'linear-gradient(135deg, rgba(26, 32, 64, 0.8) 0%, rgba(26, 32, 64, 0.9) 100%)';
            
            // Clear any previous fallback divs
            const existingFallback = featuredImage.parentElement.querySelector('.image-fallback');
            if (existingFallback) {
                existingFallback.remove();
            }
            
            featuredImage.style.display = 'block';
            featuredImage.src = imageUrl;
            featuredImage.alt = article.title || 'Imagen del art√≠culo';
            
            // Add error handling for failed image loads
            featuredImage.onerror = function() {
                console.log('Failed to load image from:', imageUrl, 'using default');
                this.src = '/static/img/default-news.svg';
                this.alt = 'Imagen por defecto';
                this.style.opacity = '1';
                
                // If even the default SVG fails, create a CSS-based fallback
                this.onerror = function() {
                    console.log('Default SVG also failed, using CSS fallback');
                    this.style.display = 'none';
                    const fallbackDiv = document.createElement('div');
                    fallbackDiv.className = 'image-fallback';
                    fallbackDiv.innerHTML = `
                        <div class="fallback-content">
                            <i class="fas fa-newspaper" style="font-size: 2rem; color: #46ead7; margin-bottom: 8px;"></i>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); font-weight: 600;">Imagen no disponible</div>
                            <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">Fuente sin imagen</div>
                        </div>
                    `;
                    this.parentElement.appendChild(fallbackDiv);
                    this.onerror = null;
                };
            };
            
            // Add success handling
            featuredImage.onload = function() {
                console.log('Image loaded successfully from:', imageUrl);
                this.style.opacity = '1';
            };
        } else {
            console.log('No valid image URL available, using default. Article data:', article);
            
            // Clear any previous fallback divs
            const existingFallback = featuredImage.parentElement.querySelector('.image-fallback');
            if (existingFallback) {
                existingFallback.remove();
            }
            
            featuredImage.style.display = 'block';
            featuredImage.src = '/static/img/default-news.svg';
            featuredImage.alt = 'Imagen por defecto';
            featuredImage.style.opacity = '1';
            
            // Set up fallback for the default image as well
            featuredImage.onerror = function() {
                console.log('Default SVG failed to load, using CSS fallback');
                this.style.display = 'none';
                const fallbackDiv = document.createElement('div');
                fallbackDiv.className = 'image-fallback';
                fallbackDiv.innerHTML = `
                    <div class="fallback-content">
                        <i class="fas fa-newspaper" style="font-size: 2rem; color: #46ead7; margin-bottom: 8px;"></i>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); font-weight: 600;">Imagen no disponible</div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">Fuente sin imagen</div>
                    </div>
                `;
                this.parentElement.appendChild(fallbackDiv);
                this.onerror = null;
            };
        }
    }
    
    // Update risk badge
    const riskBadge = document.getElementById('featuredRiskBadge');
    if (riskBadge) {
        const riskLevel = (article.risk_level || 'medium').toLowerCase();
        
        if (riskLevel === 'high') {
            riskBadge.textContent = 'ALTO RIESGO';
            riskBadge.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            riskBadge.style.boxShadow = '0 4px 12px rgba(239, 68, 68, 0.4)';
        } else if (riskLevel === 'medium') {
            riskBadge.textContent = 'RIESGO MEDIO';
            riskBadge.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
            riskBadge.style.boxShadow = '0 4px 12px rgba(245, 158, 11, 0.4)';
        } else {
            riskBadge.textContent = 'BAJO RIESGO';
            riskBadge.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            riskBadge.style.boxShadow = '0 4px 12px rgba(16, 185, 129, 0.4)';
        }
    }
    
    // Update text content with null checks
    const featuredTitle = document.getElementById('featuredTitle');
    if (featuredTitle) {
        featuredTitle.textContent = article.title || 'Sin t√≠tulo';
    }
    
    const featuredDate = document.getElementById('featuredDate');
    if (featuredDate) {
        featuredDate.textContent = article.created_at ? 
            new Date(article.created_at).toLocaleDateString('es-ES') : 
            'Fecha no disponible';
    }
    
    const featuredLocation = document.getElementById('featuredLocation');
    if (featuredLocation) {
        featuredLocation.textContent = article.country || article.location || 'Global';
    }
    
    // Update time
    const featuredTime = document.getElementById('featuredTime');
    if (featuredTime) {
        if (article.created_at) {
            const time = new Date(article.created_at).toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            featuredTime.textContent = time;
        } else {
            featuredTime.textContent = '--:--';
        }
    }
    
    const featuredDescription = document.getElementById('featuredDescription');
    if (featuredDescription) {
        featuredDescription.textContent = article.content || article.summary || 
                                          article.description || 'Sin descripci√≥n disponible';
    }
    
    // Update read more button
    const readMoreBtn = document.getElementById('featuredReadMore');
    if (readMoreBtn) {
        const sourceUrl = article.source_url || article.url || article.link;
        if (sourceUrl && sourceUrl !== '') {
            readMoreBtn.href = sourceUrl;
            readMoreBtn.target = '_blank';
            readMoreBtn.onclick = null;
        } else {
            readMoreBtn.href = '#';
            readMoreBtn.onclick = (e) => {
                e.preventDefault();
                showNotification('No hay enlace disponible para este art√≠culo', 'warning');
            };
        }
    }
    
    console.log('Featured article updated successfully');
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle"></i>
            <span>${message}</span>
        </div>
    `;
    
    // Add styles
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// AI Geopolitical Analysis Functions
async function loadAIGeopoliticalAnalysis() {
    const container = document.getElementById('aiAnalysisContent');
    if (!container) return;
    
    // Show loading state
    container.innerHTML = `
        <div class="ai-loading-state">
            <i class="fas fa-edit" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.6; color: #46ead7;"></i>
            <h4 style="margin-bottom: 10px; color: #fff;">Generando an√°lisis geopol√≠tico...</h4>
            <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Nuestro periodista de IA est√° preparando un resumen exhaustivo de la actualidad mundial</p>
            <div class="loading-spinner" style="margin-top: 20px;">
                <i class="fas fa-spinner fa-spin" style="color: #46ead7; font-size: 1.5rem;"></i>
            </div>
        </div>
    `;
    
    try {
        // Get recent articles for context
        const articlesResponse = await fetch('/api/articles?limit=20');
        const articles = await articlesResponse.json();
        
        // Call the AI analysis endpoint
        const response = await fetch('/api/ai/geopolitical-analysis', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                articles: articles,
                analysis_type: 'journalistic_analysis'
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const analysisData = await response.json();
        displayAIAnalysis(analysisData.analysis);
        
    } catch (error) {
        console.error('Error loading AI analysis:', error);
        container.innerHTML = `
            <div class="ai-loading-state">
                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.6; color: #ef4444;"></i>
                <h4 style="margin-bottom: 10px; color: #fff;">Error al generar an√°lisis</h4>
                <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">No se pudo conectar con el servicio de an√°lisis. Int√©ntalo de nuevo.</p>
                <button onclick="loadAIGeopoliticalAnalysis()" style="margin-top: 15px; padding: 8px 16px; background: #46ead7; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-redo"></i> Reintentar
                </button>
            </div>
        `;
        showNotification('Error al generar an√°lisis geopol√≠tico', 'error');
    }
}

function displayAIAnalysis(analysisText) {
    const container = document.getElementById('aiAnalysisContent');
    if (!container || !analysisText) return;
    
    const currentDate = new Date().toLocaleDateString('es-ES', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    const currentTime = new Date().toLocaleTimeString('es-ES', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // Process the analysis text to add proper structure
    const processedAnalysis = processAnalysisText(analysisText);
    
    container.innerHTML = `
        <div class="ai-article-content">
            <div class="ai-article-header">
                <h2 class="ai-article-title">Panorama Geopol√≠tico Global</h2>
                <h3 class="ai-article-subtitle">Un an√°lisis en profundidad de los acontecimientos que moldean el mundo</h3>
                <div class="ai-article-meta">
                    <div class="ai-meta-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>${currentDate}</span>
                    </div>
                    <div class="ai-meta-item">
                        <i class="fas fa-clock"></i>
                        <span>${currentTime}</span>
                    </div>
                    <div class="ai-meta-item">
                        <i class="fas fa-robot"></i>
                        <span>An√°lisis generado por IA</span>
                    </div>
                </div>
            </div>
            
            <div class="ai-article-body">
                ${processedAnalysis}
            </div>
            
            <div class="ai-article-footer">
                <p class="ai-byline">
                    <i class="fas fa-info-circle"></i>
                    Este an√°lisis ha sido generado por inteligencia artificial bas√°ndose en las √∫ltimas noticias geopol√≠ticas disponibles. 
                    La perspectiva refleja una posici√≥n favorable a la paz mundial y la sostenibilidad ambiental.
                </p>
            </div>
        </div>
    `;
    
    showNotification('An√°lisis geopol√≠tico generado exitosamente', 'success');
}

function processAnalysisText(text) {
    // Clean and structure the text
    let processed = text.replace(/\n\n/g, '</p><p class="ai-article-paragraph">');
    processed = processed.replace(/\n/g, '<br>');
    
    // Add paragraph tags at the beginning and end
    processed = '<p class="ai-article-paragraph">' + processed + '</p>';
    
    // Highlight important terms (countries, leaders, organizations)
    const importantTerms = [
        'Estados Unidos', 'China', 'Rusia', 'Ucrania', 'Europa', 'OTAN', 'ONU', 'FMI',
        'Biden', 'Xi Jinping', 'Putin', 'Zelensky', 'Trump',
        'Gaza', 'Israel', 'Palestina', 'Oriente Medio', 'Taiw√°n', 'Corea del Norte',
        'cambio clim√°tico', 'energ√≠a renovable', 'petr√≥leo', 'gas natural',
        'inflaci√≥n', 'econom√≠a global', 'cadenas de suministro'
    ];
    
    importantTerms.forEach(term => {
        const regex = new RegExp(`\\b${term}\\b`, 'gi');
        processed = processed.replace(regex, `<span class="ai-highlight">${term}</span>`);
    });
    
    // Add sections for better structure
    if (processed.length > 1000) {
        const sections = processed.split('</p><p class="ai-article-paragraph">');
        if (sections.length > 3) {
            const sectionTitles = [
                'Panorama Pol√≠tico Global',
                'Tensiones Econ√≥micas y Energ√©ticas',
                'Conflictos y Diplomacia',
                'Perspectivas y Desaf√≠os'
            ];
            
            let structuredContent = '';
            for (let i = 0; i < sections.length; i++) {
                if (i < sectionTitles.length && i > 0) {
                    structuredContent += `
                        <div class="ai-article-section">
                            <h4 class="ai-section-title">${sectionTitles[i]}</h4>
                            ${sections[i]}
                        </div>
                    `;
                } else {
                    structuredContent += sections[i];
                    if (i < sections.length - 1) {
                        structuredContent += '</p><p class="ai-article-paragraph">';
                    }
                }
            }
            return structuredContent;
        }
    }
    
    return processed;
}

function exportAIArticle() {
    const articleContent = document.querySelector('.ai-article-content');
    if (!articleContent) {
        showNotification('No hay art√≠culo para exportar', 'warning');
        return;
    }
    
    const title = document.querySelector('.ai-article-title')?.textContent || 'An√°lisis Geopol√≠tico';
    const content = articleContent.innerHTML;
    
    // Create a clean HTML document
    const htmlContent = `
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>${title}</title>
        <style>
            body { 
                font-family: 'Georgia', serif; 
                max-width: 800px; 
                margin: 0 auto; 
                padding: 20px; 
                background: #1a1a2e; 
                color: #e8eaed; 
                line-height: 1.6; 
            }
            .ai-article-content { 
                background: rgba(255, 255, 255, 0.05); 
                padding: 30px; 
                border-radius: 8px; 
            }
            .ai-article-title { 
                color: #46ead7; 
                font-size: 2rem; 
                margin-bottom: 10px; 
            }
            .ai-article-subtitle { 
                color: rgba(255, 255, 255, 0.8); 
                font-style: italic; 
                margin-bottom: 20px; 
            }
            .ai-highlight { 
                background: rgba(102, 126, 234, 0.3); 
                padding: 2px 4px; 
                border-radius: 3px; 
            }
            .ai-section-title { 
                color: #46ead7; 
                border-left: 3px solid #46ead7; 
                padding-left: 15px; 
                margin: 25px 0 15px 0; 
            }
            .ai-article-paragraph { 
                margin-bottom: 15px; 
                text-align: justify; 
            }
            .ai-article-footer { 
                margin-top: 30px; 
                padding-top: 20px; 
                border-top: 1px solid rgba(255, 255, 255, 0.2); 
                font-size: 0.9rem; 
                color: rgba(255, 255, 255, 0.7); 
            }
        </style>
    </head>
    <body>
        ${content}
    </body>
    </html>
    `;
    
    // Create and download the file
    const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `analisis-geopolitico-${new Date().toISOString().split('T')[0]}.html`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('Art√≠culo exportado exitosamente', 'success');
}

// News Mosaic Functions - Hybrid: Real data with Mock fallback
async function loadNewsMosaic() {
    console.log('Loading news mosaic - HYBRID VERSION (real + mock fallback)...');
    const container = document.querySelector('.news-mosaic-container');
    
    if (!container) {
        console.error('Container .news-mosaic-container not found!');
        return;
    }
    
    // Show loading state
    container.innerHTML = `
        <div class="mosaic-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Cargando mosaico de noticias...</p>
        </div>
    `;
    
    // Mock data for fallback
    const mockArticles = [
        {
            id: 1,
            title: "Crisis diplom√°tica se intensifica en Europa Oriental",
            location: "Ucrania",
            risk_level: "high",
            image_url: "https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800&h=600&fit=crop"
        },
        {
            id: 2,
            title: "Negociaciones comerciales entre potencias mundiales",
            location: "Estados Unidos", 
            risk_level: "medium",
            image_url: "https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=800&h=600&fit=crop"
        },
        {
            id: 3,
            title: "Tensiones geopol√≠ticas en el Mar del Sur de China",
            location: "China",
            risk_level: "high",
            image_url: "https://images.unsplash.com/photo-1445019980597-93fa8acb246c?w=800&h=600&fit=crop"
        },
        {
            id: 4,
            title: "Cumbre de l√≠deres regionales aborda seguridad",
            location: "Medio Oriente",
            risk_level: "medium",
            image_url: "https://images.unsplash.com/photo-1541336032412-2048a678540d?w=800&h=600&fit=crop"
        },
        {
            id: 5,
            title: "Ejercicios militares conjuntos preocupan a vecinos",
            location: "Corea del Norte",
            risk_level: "high",
            image_url: "https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=800&h=600&fit=crop"
        },
        {
            id: 6,
            title: "Acuerdo energ√©tico estrat√©gico entre naciones",
            location: "Rusia",
            risk_level: "low",
            image_url: "https://images.unsplash.com/photo-1473649085228-583485e6e4d7?w=800&h=600&fit=crop"
        },
        {
            id: 7,
            title: "Migraci√≥n masiva causa tensiones fronterizas",
            location: "Europa",
            risk_level: "medium",
            image_url: "https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=800&h=600&fit=crop"
        },
        {
            id: 8,
            title: "Disputa territorial escalada en zona fronteriza",
            location: "India",
            risk_level: "high",
            image_url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop"
        },
        {
            id: 9,
            title: "Reuni√≥n de emergencia en consejo de seguridad",
            location: "Nueva York",
            risk_level: "medium",
            image_url: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&h=600&fit=crop"
        },
        {
            id: 10,
            title: "Operaciones de paz se intensifican en regi√≥n",
            location: "√Åfrica",
            risk_level: "low",
            image_url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&h=600&fit=crop"
        }
    ];
    
    try {
        console.log('Step 1: Attempting to fetch real articles...');
        
        // Try to fetch real data with timeout
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
        
        const response = await fetch('/api/articles?limit=15', {
            signal: controller.signal,
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        clearTimeout(timeoutId);
        
        if (response.ok) {
            const data = await response.json();
            console.log('Step 2: Real data received:', data);
            
            // Handle different possible response formats
            let articles = [];
            if (Array.isArray(data)) {
                articles = data;
            } else if (data.articles && Array.isArray(data.articles)) {
                articles = data.articles;
            } else if (data.data && Array.isArray(data.data)) {
                articles = data.data;
            }
            
            if (articles.length > 0) {
                console.log(`Step 3: Using ${articles.length} real articles`);
                setTimeout(() => renderBasicMosaic(articles), 500);
                return;
            }
        }
        
        throw new Error('No real articles available');
        
    } catch (error) {
        console.warn('Real data fetch failed:', error.message);
        console.log('Step 3: Falling back to mock data...');
        
        // Use mock data as fallback
        setTimeout(() => {
            console.log('Step 4: Rendering mock mosaic...');
            renderBasicMosaic(mockArticles);
        }, 1000);
    }
}

// Enhanced mosaic renderer with better error handling
function renderBasicMosaic(articles) {
    const container = document.querySelector('.news-mosaic-container');
    console.log('Rendering basic mosaic with', articles.length, 'articles');
    
    if (!container) {
        console.error('Container not found for rendering!');
        return;
    }
    
    if (!articles || articles.length === 0) {
        container.innerHTML = `
            <div class="mosaic-loading">
                <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i>
                <p>No hay art√≠culos disponibles para el mosaico</p>
            </div>
        `;
        return;
    }
    
    const mosaicHTML = articles.map((article, index) => {
        // Enhanced size assignment for better visual variety
        let sizeClass = 'size-small-square';
        
        // First article is always hero
        if (index === 0) {
            sizeClass = 'size-hero';
        }
        // Next articles get varied sizes based on index and content
        else if (index === 1) {
            sizeClass = 'size-large-wide';
        }
        else if (index === 2) {
            sizeClass = 'size-large-tall';
        }
        else if (index === 3) {
            sizeClass = 'size-medium-wide';
        }
        else if (index === 4) {
            sizeClass = 'size-medium-square';
        }
        else if (index === 5) {
            sizeClass = 'size-medium-tall';
        }
        else if (index === 6) {
            sizeClass = 'size-small-wide';
        }
        else if (index === 7) {
            sizeClass = 'size-small-tall';
        }
        else if (index === 8) {
            sizeClass = 'size-mini-wide';
        }
        else if (index === 9) {
            sizeClass = 'size-mini-square';
        }
        else {
            sizeClass = 'size-tiny';
        }
        
        const title = (article.title || 'Sin t√≠tulo').substring(0, 100);
        const location = article.location || article.country || 'Global';
        const riskLevel = article.risk_level || 'low';
        const defaultImage = 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800&h=600&fit=crop';
        const backgroundImage = article.image_url || article.image || article.urlToImage || defaultImage;
        
        // Escape quotes for onclick
        const titleEscaped = title.replace(/'/g, "\\'").replace(/"/g, '\\"');
        
        return `
            <div class="mosaic-article ${sizeClass}" 
                 style="background-image: url('${backgroundImage}')"
                 data-article-id="${article.id || index}"
                 data-size="${sizeClass}"
                 onclick="console.log('Article clicked:', '${titleEscaped}')">
                <div class="mosaic-content">
                    <h3 class="mosaic-title">${title}</h3>
                    <div class="mosaic-meta">
                        <span class="mosaic-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${location}
                        </span>
                        <span class="mosaic-risk-badge ${riskLevel}">
                            ${riskLevel.toUpperCase()}
                        </span>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    container.innerHTML = mosaicHTML;
    console.log('‚úÖ Mosaic rendered successfully with', articles.length, 'articles!');
    console.log('‚úÖ Sizes used:', articles.map((_, i) => {
        if (i === 0) return 'hero';
        if (i === 1) return 'large-wide';
        if (i === 2) return 'large-tall';
        if (i === 3) return 'medium-wide';
        if (i === 4) return 'medium-square';
        if (i === 5) return 'medium-tall';
        if (i === 6) return 'small-wide';
        if (i === 7) return 'small-tall';
        if (i === 8) return 'mini-wide';
        if (i === 9) return 'mini-square';
        return 'tiny';
    }));
}
        
        // Array of irregular size classes for true collage effect
        const sizeClasses = [
            'size-hero',
            'size-large-wide', 'size-large-tall',
            'size-medium-wide', 'size-medium-square', 'size-medium-tall',
            'size-small-wide', 'size-small-square', 'size-small-tall',
            'size-mini-wide', 'size-mini-square',
            'size-tiny'
        ];
        
        // Size class weights for irregular distribution
        const sizeWeights = {
            'size-hero': 48,      // 8√ó6 = 48 grid units
            'size-large-wide': 28, // 7√ó4 = 28 grid units
            'size-large-tall': 25, // 5√ó5 = 25 grid units
            'size-medium-wide': 18, // 6√ó3 = 18 grid units
            'size-medium-square': 16, // 4√ó4 = 16 grid units
            'size-medium-tall': 15, // 3√ó5 = 15 grid units
            'size-small-wide': 10, // 5√ó2 = 10 grid units
            'size-small-square': 9, // 3√ó3 = 9 grid units
            'size-small-tall': 8, // 2√ó4 = 8 grid units
            'size-mini-wide': 8, // 4√ó2 = 8 grid units
            'size-mini-square': 4, // 2√ó2 = 4 grid units
            'size-tiny': 3        // 3√ó1 = 3 grid units
        };
        
        // AI-powered importance calculation using real NLP models
        async function calculateArticleImportance(article) {
            try {
                // Call our AI endpoint for real importance calculation
                const response = await fetch('/api/calculate-importance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: article.title,
                        content: article.content || article.summary || article.description,
                        location: article.location || article.country,
                        risk_level: article.risk_level,
                        published_date: article.published_date || article.date_published || article.pubDate,
                        source: article.source || article.source_url
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.importance_score;
                } else {
                    console.warn('AI importance calculation failed, using fallback');
                    return calculateFallbackImportance(article);
                }
            } catch (error) {
                console.warn('AI service unavailable, using fallback:', error);
                return calculateFallbackImportance(article);
            }
        }
        
        // Fallback importance calculation if AI service is unavailable
        function calculateFallbackImportance(article) {
            let score = 0;
            
            // Risk level weight (40% of importance)
            const riskWeights = {
                'high': 100,
                'medium': 60,
                'low': 30
            };
            score += (riskWeights[article.risk_level] || 50) * 0.4;
            
            // Recency weight (30% of importance)
            const publishedDate = new Date(article.published_date || article.date_published || article.pubDate || Date.now());
            const now = new Date();
            const hoursOld = (now - publishedDate) / (1000 * 60 * 60);
            const recencyScore = Math.max(0, 100 - (hoursOld / 24) * 10); // Decreases over days
            score += recencyScore * 0.3;
            
            // Content keywords weight (20% of importance)
            const highImpactKeywords = [
                'guerra', 'conflicto', 'crisis', 'emergencia', 'ataque', 'bomba',
                'muerte', 'muertos', 'v√≠ctimas', 'evacuaci√≥n', 'desastre',
                'terremoto', 'tsunami', 'hurac√°n', 'incendio', 'explosi√≥n'
            ];
            const title = (article.title || '').toLowerCase();
            const content = (article.content || article.summary || article.description || '').toLowerCase();
            const keywordMatches = highImpactKeywords.filter(keyword => 
                title.includes(keyword) || content.includes(keyword)
            ).length;
            score += Math.min(keywordMatches * 15, 60) * 0.2;
            
            // Location importance (10% of importance)
            const highRiskLocations = [
                'ucrania', 'gaza', 'israel', 'siria', 'afganist√°n', 'yemen',
                'somalia', 'sud√°n', 'myanmar', 'venezuela'
            ];
            const location = (article.location || article.country || '').toLowerCase();
            const isHighRiskLocation = highRiskLocations.some(loc => location.includes(loc));
            score += (isHighRiskLocation ? 80 : 40) * 0.1;
            
            return Math.min(Math.max(score, 0), 100);
        }
        
        // Assign size class based on importance score with irregularity
        function assignSizeClass(importance, index, totalArticles) {
            // Add randomness for irregular layout
            const randomFactor = (Math.sin(index * 7.3) + Math.cos(index * 3.7)) * 10;
            const adjustedImportance = Math.max(0, Math.min(100, importance + randomFactor));
            
            // Ensure distribution variety - prevent too many of the same size
            const positionFactor = (index / totalArticles) * 20;
            const finalScore = adjustedImportance - positionFactor;
            
            if (finalScore >= 85) return 'size-hero';
            if (finalScore >= 75) return Math.random() > 0.5 ? 'size-large-wide' : 'size-large-tall';
            if (finalScore >= 65) {
                const mediumSizes = ['size-medium-wide', 'size-medium-square', 'size-medium-tall'];
                return mediumSizes[index % mediumSizes.length];
            }
            if (finalScore >= 45) {
                const smallSizes = ['size-small-wide', 'size-small-square', 'size-small-tall'];
                return smallSizes[index % smallSizes.length];
            }
            if (finalScore >= 25) {
                const miniSizes = ['size-mini-wide', 'size-mini-square'];
                return miniSizes[index % miniSizes.length];
            }
            return 'size-tiny';
        }
        
        // Enhanced article rendering with AI importance and irregular layout
        async function renderMosaicArticles(articles) {
            const container = document.querySelector('.news-mosaic-container');
            if (!articles || articles.length === 0) {
                container.innerHTML = `
                    <div class="mosaic-loading">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>No hay art√≠culos disponibles</span>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="mosaic-loading">
                    <i class="fas fa-brain"></i>
                    <span>Analizando importancia con IA...</span>
                </div>
            `;
            
            // Calculate importance for all articles using AI
            const articlesWithImportance = await Promise.all(
                articles.map(async (article, index) => ({
                    ...article,
                    importance: await calculateArticleImportance(article),
                    originalIndex: index
                }))
            );
            
            // Sort by importance but then shuffle for irregular layout
            articlesWithImportance.sort((a, b) => b.importance - a.importance);
            
            // Create irregularly shuffled array while maintaining some importance clustering
            const shuffledArticles = [];
            const highImportance = articlesWithImportance.filter(a => a.importance >= 70);
            const mediumImportance = articlesWithImportance.filter(a => a.importance >= 40 && a.importance < 70);
            const lowImportance = articlesWithImportance.filter(a => a.importance < 40);
            
            // Interleave importance levels for irregular but balanced layout
            const maxLength = Math.max(highImportance.length, mediumImportance.length, lowImportance.length);
            for (let i = 0; i < maxLength; i++) {
                if (highImportance[i]) shuffledArticles.push(highImportance[i]);
                if (mediumImportance[i]) shuffledArticles.push(mediumImportance[i]);
                if (mediumImportance[i + maxLength/2]) shuffledArticles.push(mediumImportance[i + maxLength/2]);
                if (lowImportance[i]) shuffledArticles.push(lowImportance[i]);
                if (lowImportance[i + maxLength/3]) shuffledArticles.push(lowImportance[i + maxLength/3]);
                if (lowImportance[i + 2*maxLength/3]) shuffledArticles.push(lowImportance[i + 2*maxLength/3]);
            }
            
            // Render articles in irregular mosaic layout
            container.innerHTML = shuffledArticles.map((article, index) => {
                const sizeClass = assignSizeClass(article.importance, index, shuffledArticles.length);
                const defaultImage = 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800&h=600&fit=crop';
                const backgroundImage = article.image_url || article.image || article.urlToImage || defaultImage;
                
                const riskClass = article.importance >= 85 ? 'hero' : article.risk_level;
                
                return `
                    <div class="mosaic-article ${sizeClass}" 
                         style="background-image: url('${backgroundImage}')"
                         data-article-id="${article.id}"
                         data-importance="${article.importance.toFixed(1)}"
                         onclick="openArticleModal(${JSON.stringify(article).replace(/"/g, '&quot;')})">
                        <div class="mosaic-content">
                            <h3 class="mosaic-title">${article.title}</h3>
                            <div class="mosaic-meta">
                                <span class="mosaic-location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${article.location || article.country || 'Ubicaci√≥n desconocida'}
                                </span>
                                <span class="mosaic-risk-badge ${riskClass}">
                                    ${article.risk_level} (${article.importance.toFixed(0)}%)
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            console.log(`Rendered ${shuffledArticles.length} articles with AI-calculated importance`);
        }
        
    } catch (error) {
        console.error('Error loading mosaic:', error);
        container.innerHTML = `
            <div class="mosaic-loading">
                <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                <p>Error al cargar el mosaico de noticias</p>
            </div>
        `;
        showNotification('Error al cargar noticias', 'error');
    }
}

function calculateArticleImportance(article) {
    let score = 0;
    
    // Base score from risk level
    const riskScores = {
        'high': 100,
        'medium': 60,
        'low': 30
    };
    score += riskScores[article.risk_level] || 20;
    
    // Recency bonus (newer articles get higher scores)
    const articleDate = new Date(article.published_date || article.date_published || article.pubDate || Date.now());
    const now = new Date();
    const hoursDiff = (now - articleDate) / (1000 * 60 * 60);
    
    if (hoursDiff < 1) score += 50;        // Within 1 hour
    else if (hoursDiff < 6) score += 30;   // Within 6 hours
    else if (hoursDiff < 24) score += 20;  // Within 24 hours
    else if (hoursDiff < 72) score += 10;  // Within 3 days
    
    // Content quality indicators
    if (article.title && article.title.length > 50) score += 10;
    if (article.description && article.description.length > 100) score += 10;
    if (article.image_url || article.image || article.urlToImage) score += 15;
    
    // Keyword importance (simulate NLP sentiment/importance analysis)
    const importantKeywords = [
        'guerra', 'conflicto', 'crisis', 'emergencia', 'ataque', 'explosi√≥n',
        'gobierno', 'elecciones', 'econ√≥mico', 'militar', 'terrorismo',
        'internacional', 'diplom√°tico', 'sanci√≥n', 'tratado'
    ];
    
    const text = (article.title + ' ' + (article.description || '')).toLowerCase();
    importantKeywords.forEach(keyword => {
        if (text.includes(keyword)) score += 5;
    });
    
    // Location importance (major regions get higher scores)
    const majorRegions = ['ucrania', 'rusia', 'china', 'estados unidos', 'europa', 'medio oriente'];
    const location = (article.location || article.country || '').toLowerCase();
    majorRegions.forEach(region => {
        if (location.includes(region)) score += 15;
    });
    
    return Math.min(score, 200); // Cap at 200
}

function createMosaicLayout(articles) {
    const container = document.getElementById('newsMosaicGrid');
    
    if (!articles || articles.length === 0) {
        container.innerHTML = `
            <div class="mosaic-loading">
                <i class="fas fa-newspaper" style="color: #46ead7;"></i>
                <p>No hay noticias disponibles</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    
    // Take top articles for the mosaic (limit to prevent overcrowding)
    const topArticles = articles.slice(0, 20);
    
    topArticles.forEach((article, index) => {
        const tile = createMosaicTile(article, index);
        container.appendChild(tile);
    });
}

function createMosaicTile(article, index) {
    const tile = document.createElement('div');
    tile.className = 'mosaic-article';
    
    // Determine size based on importance and position
    let sizeClass = 'size-small';
    if (index === 0) {
        sizeClass = 'size-hero';
    } else if (index < 3) {
        sizeClass = 'size-large';
    } else if (index < 8) {
        sizeClass = 'size-medium';
    } else if (index < 15) {
        sizeClass = 'size-small';
    } else {
        sizeClass = 'size-mini';
    }
    
    tile.classList.add(sizeClass);
    
    // Get image URL with fallbacks
    const imageUrl = article.image_url || article.image || article.urlToImage || 
                    article.thumbnail_url || article.image_link || article.media_url ||
                    article.thumbnail || article.picture_url || article.photo_url ||
                    '/static/img/default-news.svg';
    
    // Set background image
    if (imageUrl && imageUrl !== '/static/img/default-news.svg') {
        tile.style.backgroundImage = `url("${imageUrl}")`;
    } else {
        tile.style.background = `linear-gradient(135deg, 
            rgba(26, 32, 64, 0.9) 0%, 
            rgba(16, 24, 48, 0.9) 50%, 
            rgba(20, 28, 56, 0.9) 100%
        )`;
    }
    
    // Determine risk badge text and class
    let riskText = article.risk_level || 'low';
    let riskClass = riskText;
    
    if (index === 0) {
        riskText = 'NOTICIA DE MAYOR RIESGO';
        riskClass = 'hero';
    }
    
    // Create tile content
    tile.innerHTML = `
        <div class="mosaic-content">
            <h3 class="mosaic-title">${article.title || 'Sin t√≠tulo'}</h3>
            <div class="mosaic-meta">
                <span class="mosaic-location">
                    <i class="fas fa-map-marker-alt"></i>
                    ${article.location || article.country || 'Global'}
                </span>
                <span class="mosaic-risk-badge ${riskClass}">
                    ${riskText.toUpperCase()}
                </span>
            </div>
        </div>
    `;
    
    // Add click handler
    tile.addEventListener('click', () => {
        openArticleModal(article);
    });
    
    return tile;
}

function openArticleModal(article) {
    // Create modal for article details
    const modal = document.createElement('div');
    modal.className = 'article-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>${article.title || 'Sin t√≠tulo'}</h2>
            <div class="modal-meta">
                <span><i class="fas fa-map-marker-alt"></i> ${article.location || article.country || 'Global'}</span>
                <span><i class="fas fa-calendar"></i> ${new Date(article.published_date || article.date_published || Date.now()).toLocaleDateString()}</span>
                <span class="risk-badge ${article.risk_level}">${(article.risk_level || 'low').toUpperCase()}</span>
            </div>
            <p>${article.description || article.summary || 'No hay descripci√≥n disponible.'}</p>
            <div class="modal-actions">
                <a href="${article.source_url || article.url || article.link || '#'}" target="_blank" class="btn-primary">
                    <i class="fas fa-external-link-alt"></i> Leer art√≠culo completo
                </a>
            </div>
        </div>
    `;
    
    // Add modal styles
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.8); z-index: 1000; display: flex; 
        align-items: center; justify-content: center; padding: 20px;
    `;
    
    modal.querySelector('.modal-content').style.cssText = `
        background: linear-gradient(135deg, rgba(26, 32, 64, 0.95) 0%, rgba(16, 24, 48, 0.95) 100%);
        padding: 30px; border-radius: 12px; max-width: 600px; width: 100%;
        color: white; position: relative; backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    `;
    
    // Close modal handlers
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });
    
    modal.querySelector('.modal-close').addEventListener('click', () => {
        modal.remove();
    });
    
    modal.querySelector('.modal-close').style.cssText = `
        position: absolute; top: 10px; right: 15px; font-size: 24px;
        cursor: pointer; color: rgba(255, 255, 255, 0.7);
    `;
    
    document.body.appendChild(modal);
}

function filterNewsMosaic() {
    // Implement filtering logic here
    showNotification('Funci√≥n de filtrado en desarrollo', 'info');
}
</script>
{% endblock %}