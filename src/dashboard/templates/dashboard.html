{% extends "layout.html" %}

{% block title %}{{ translations['dashboard_title'] }}{% endblock %}

{% block content %}
<!-- 3D Earth Wireframe Background -->
<div id="earth-wireframe">
    <div class="earth-container">
        <div class="earth-sphere">
            <!-- Latitude lines -->
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lat-line"></div>
            <!-- Longitude lines -->
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <div class="wireframe-line lon-line"></div>
            <!-- Orbital rings -->
            <div class="orbital-ring"></div>
            <div class="orbital-ring"></div>
            <!-- Data points representing global monitoring stations -->
            <div class="data-point" style="top: 25%; left: 15%;"></div>
            <div class="data-point" style="top: 35%; left: 45%;"></div>
            <div class="data-point" style="top: 45%; left: 75%;"></div>
            <div class="data-point" style="top: 55%; left: 25%;"></div>
            <div class="data-point" style="top: 65%; left: 65%;"></div>
            <div class="data-point" style="top: 30%; left: 85%;"></div>
            <div class="data-point" style="top: 70%; left: 35%;"></div>
            <div class="data-point" style="top: 40%; left: 55%;"></div>
        </div>
    </div>
</div>
<style>
    /* 3D Earth Wireframe Background Styles */
    #earth-wireframe { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: linear-gradient(135deg, rgba(13,25,43,0.95) 0%, rgba(27,39,53,0.95) 25%, rgba(15,32,46,0.95) 50%, rgba(8,22,36,0.95) 75%, rgba(11,19,32,0.95) 100%); background-attachment: fixed; overflow: hidden; }
    .earth-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 800px; height: 800px; perspective: 1000px; }
    .earth-sphere { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; animation: earthRotation 60s linear infinite; }
    @keyframes earthRotation { 0% { transform: rotateY(0deg) rotateX(15deg); } 100% { transform: rotateY(360deg) rotateX(15deg); } }
    .wireframe-line { position: absolute; background: linear-gradient(90deg, transparent, #00ffff, transparent); box-shadow: 0 0 10px rgba(0,255,255,0.5); opacity: 0.6; }
    .lat-line { width: 100%; height: 2px; border-radius: 1px; left: 0; animation: wireframePulse 4s ease-in-out infinite; }
    .lat-line:nth-child(1) { top:10%; transform: scaleX(0.3); }
    .lat-line:nth-child(2) { top:20%; transform: scaleX(0.6); }
    .lat-line:nth-child(3) { top:30%; transform: scaleX(0.8); }
    .lat-line:nth-child(4) { top:40%; transform: scaleX(0.95); }
    .lat-line:nth-child(5) { top:50%; transform: scaleX(1); }
    .lat-line:nth-child(6) { top:60%; transform: scaleX(0.95); }
    .lat-line:nth-child(7) { top:70%; transform: scaleX(0.8); }
    .lat-line:nth-child(8) { top:80%; transform: scaleX(0.6); }
    .lat-line:nth-child(9) { top:90%; transform: scaleX(0.3); }
    .lon-line { width:2px; height:100%; border-radius:1px; top:0; animation: wireframePulse 4s ease-in-out infinite; animation-delay:2s; }
    .lon-line:nth-child(10) { left:10%; }
    .lon-line:nth-child(11) { left:20%; }
    .lon-line:nth-child(12) { left:30%; }
    .lon-line:nth-child(13) { left:40%; }
    .lon-line:nth-child(14) { left:50%; }
    .lon-line:nth-child(15) { left:60%; }
    .lon-line:nth-child(16) { left:70%; }
    .lon-line:nth-child(17) { left:80%; }
    .lon-line:nth-child(18) { left:90%; }
    @keyframes wireframePulse { 0%,100% { opacity:0.4; box-shadow:0 0 10px rgba(0,255,255,0.3); } 50% { opacity:0.8; box-shadow:0 0 20px rgba(0,255,255,0.7); } }
    .orbital-ring { position:absolute; border:2px solid rgba(0,255,255,0.3); border-radius:50%; animation: orbitalRotation 30s linear infinite; }
    .orbital-ring:nth-child(19) { width:120%; height:120%; top:-10%; left:-10%; transform:rotateX(60deg); }
    .orbital-ring:nth-child(20) { width:140%; height:140%; top:-20%; left:-20%; transform:rotateX(30deg); animation-direction:reverse; animation-duration:45s; }
    @keyframes orbitalRotation { 0% { transform:rotateX(60deg) rotateZ(0deg); } 100% { transform:rotateX(60deg) rotateZ(360deg); } }
    .data-point { position:absolute; width:4px; height:4px; background:#00ffff; border-radius:50%; box-shadow:0 0 8px rgba(0,255,255,0.8); animation:dataPointPulse 2s ease-in-out infinite; }
    @keyframes dataPointPulse { 0%,100% { transform:scale(1); opacity:0.8; } 50% { transform:scale(1.5); opacity:1; } }
    @media(max-width:1200px){ .earth-container{width:600px;height:600px;} }
    @media(max-width:768px){ .earth-container{width:400px;height:400px;} }
    @media(max-width:576px){ .earth-container{width:300px;height:300px;} }
</style>
<div class="container mx-auto px-4">
    <!-- Stat Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-globe-americas text-4xl text-blue-400 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">Global Risk Index</div>
                <div id="global-risk-index" class="text-2xl font-bold">--</div>
            </div>
        </div>
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">Critical Alerts</div>
                <div id="critical-alerts-count" class="text-2xl font-bold">--</div>
            </div>
        </div>
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-brain text-4xl text-purple-400 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">AI Confidence</div>
                <div id="ml-confidence" class="text-2xl font-bold">--%</div>
            </div>
        </div>
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-newspaper text-4xl text-green-400 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">New Articles (24h)</div>
                <div id="new-articles-count" class="text-2xl font-bold">--</div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main column -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Map -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">Risk Heatmap</h2>
                </div>
                <div class="p-4">
                    <div id="map" class="h-96 rounded-lg"></div>
                </div>
            </div>

            <!-- AI Generated Article -->
            <div class="glass-card">
                 <div class="p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">AI Journalistic Analysis</h2>
                </div>
                <div id="aiArticleContent" class="p-4"></div>
            </div>
        </div>

        <!-- Right sidebar -->
        <div class="space-y-8">
            <!-- High-Risk Events -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">High-Risk Events</h2>
                </div>
                <div id="highRiskArticlesGrid" class="p-4 max-h-96 overflow-y-auto">
                    <!-- High risk articles will be loaded here -->
                </div>
            </div>

            <!-- Recent Articles -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">Recent Articles</h2>
                </div>
                <div id="latestArticlesList" class="p-4 max-h-96 overflow-y-auto">
                    <!-- Recent articles will be loaded here -->
                </div>
            </div>
             <!-- Trend Charts -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">Risk Trends</h2>
                </div>
                <div class="p-4">
                    <div id="risk-timeline-chart" class="h-48"></div>
                </div>
            </div>
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">Risk Distribution</h2>
                </div>
                <div class="p-4">
                    <div id="risk-distribution-chart" class="h-48"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- Leaflet heatmap -->
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <!-- Dashboard functionality -->
    <script src="/static/js/modern_dashboard_fixed.js"></script>
    <script src="/static/js/enhanced_dashboard_fixed.js"></script>
{% endblock %}
