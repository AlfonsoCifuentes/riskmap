<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico 3D Earth - Capas CSS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }
        
        /* 3D Earth Background */
        #earth3d-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -10; /* MUY BAJO */
            overflow: hidden;
            background: url('/static/espacio.jpg') center center no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }

        #earth3d-canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 130vw;
            height: 130vh;
            opacity: 1; /* M√ÅXIMA OPACIDAD */
        }
        
        /* Diagn√≥stico de capas */
        .diagnostic-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            background: rgba(0,0,0,0.9);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            z-index: 9999;
            font-size: 12px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .layer-test {
            margin: 20px;
            padding: 20px;
            border: 2px solid #ff0000;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .layer-1 {
            background: rgba(255, 0, 0, 0.3);
            z-index: 1;
        }
        
        .layer-2 {
            background: rgba(0, 255, 0, 0.3);
            z-index: 2;
        }
        
        .layer-3 {
            background: rgba(0, 0, 255, 0.3);
            z-index: 3;
        }
        
        .layer-opaque {
            background: rgb(100, 100, 100); /* SIN TRANSPARENCIA */
            z-index: 4;
        }
        
        .status {
            color: #00ff00;
            font-weight: bold;
        }
        
        .error {
            color: #ff0000;
            font-weight: bold;
        }
        
        .control-button {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .control-button:hover {
            background: #555;
        }
    </style>
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <!-- 3D Earth Container -->
    <div id="earth3d-container">
        <canvas id="earth3d-canvas"></canvas>
    </div>
    
    <!-- Diagnostic Panel -->
    <div class="diagnostic-panel">
        <h3>üåç Diagn√≥stico 3D Earth</h3>
        <div id="status">Inicializando...</div>
        
        <hr>
        <h4>Controles de Capas</h4>
        <button class="control-button" onclick="toggleLayer('layer-1')">Toggle Capa 1 (Roja)</button>
        <button class="control-button" onclick="toggleLayer('layer-2')">Toggle Capa 2 (Verde)</button>
        <button class="control-button" onclick="toggleLayer('layer-3')">Toggle Capa 3 (Azul)</button>
        <button class="control-button" onclick="toggleLayer('layer-opaque')">Toggle Capa Opaca</button>
        
        <hr>
        <h4>Controles 3D</h4>
        <button class="control-button" onclick="adjustEarthOpacity(0.2)">Tierra 20%</button>
        <button class="control-button" onclick="adjustEarthOpacity(0.5)">Tierra 50%</button>
        <button class="control-button" onclick="adjustEarthOpacity(1.0)">Tierra 100%</button>
        <button class="control-button" onclick="changeEarthZIndex(-5)">Z-Index -5</button>
        <button class="control-button" onclick="changeEarthZIndex(0)">Z-Index 0</button>
        <button class="control-button" onclick="changeEarthZIndex(5)">Z-Index 5</button>
        
        <hr>
        <div id="debug-info">
            <strong>Estado actual:</strong><br>
            <span id="earth-status">Tierra: Desconocido</span><br>
            <span id="layer-status">Capas: Todas visibles</span>
        </div>
    </div>
    
    <!-- Capas de prueba -->
    <div class="layer-test layer-1" id="layer-1">
        CAPA 1 - Transparente Roja (z-index: 1)
        <br>¬øVes la tierra debajo?
    </div>
    
    <div class="layer-test layer-2" id="layer-2">
        CAPA 2 - Transparente Verde (z-index: 2)
        <br>¬øVes la tierra debajo?
    </div>
    
    <div class="layer-test layer-3" id="layer-3">
        CAPA 3 - Transparente Azul (z-index: 3)
        <br>¬øVes la tierra debajo?
    </div>
    
    <div class="layer-test layer-opaque" id="layer-opaque">
        CAPA OPACA - Sin transparencia (z-index: 4)
        <br>‚ö†Ô∏è ESTA CAPA BLOQUEA LA VISTA
    </div>

    <script>
        console.log('üåç Iniciando diagn√≥stico 3D Earth...');
        
        let scene, camera, renderer, earth;
        let animationId;
        
        function updateStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = isError ? 'error' : 'status';
        }
        
        function updateEarthStatus(message) {
            document.getElementById('earth-status').innerHTML = `Tierra: ${message}`;
        }
        
        function init3DEarth() {
            console.log('üöÄ Inicializando 3D Earth para diagn√≥stico...');
            updateStatus('üöÄ Inicializando 3D Earth...');
            
            try {
                // Get canvas
                const canvas = document.getElementById('earth3d-canvas');
                if (!canvas) {
                    throw new Error('Canvas not found');
                }
                
                // Scene
                scene = new THREE.Scene();
                console.log('‚úÖ Scene created');
                
                // Camera
                camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
                camera.position.z = 8;
                console.log('‚úÖ Camera created');
                
                // Renderer
                renderer = new THREE.WebGLRenderer({ 
                    canvas: canvas,
                    alpha: true,
                    antialias: true
                });
                renderer.setSize(window.innerWidth * 1.3, window.innerHeight * 1.3);
                renderer.setClearColor(0x000000, 0); // Transparent background
                console.log('‚úÖ Renderer created');
                
                // Lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 2);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
                directionalLight.position.set(5, 5, 5);
                scene.add(directionalLight);
                
                const pointLight = new THREE.PointLight(0x00aaff, 1, 100);
                pointLight.position.set(-5, -5, 5);
                scene.add(pointLight);
                
                console.log('‚úÖ Lighting added');
                
                // Create Earth - Sphere with bright color initially
                const geometry = new THREE.SphereGeometry(4, 64, 64);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0xff4444, // Bright red initially
                    transparent: false,
                    opacity: 1.0,
                    emissive: 0x331111 // Slight glow
                });
                
                earth = new THREE.Mesh(geometry, material);
                scene.add(earth);
                console.log('‚úÖ Earth sphere created (bright red)');
                updateEarthStatus('Esfera roja creada');
                
                // Try to load texture
                const textureLoader = new THREE.TextureLoader();
                textureLoader.load(
                    'https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg',
                    function(texture) {
                        console.log('‚úÖ Earth texture loaded');
                        earth.material.map = texture;
                        earth.material.color.setHex(0xffffff);
                        earth.material.needsUpdate = true;
                        updateEarthStatus('Textura de Tierra cargada');
                        updateStatus('‚úÖ 3D Earth con textura cargada');
                    },
                    function(progress) {
                        const percent = (progress.loaded / progress.total * 100).toFixed(1);
                        console.log(`üìà Loading texture: ${percent}%`);
                        updateStatus(`üìà Cargando textura: ${percent}%`);
                    },
                    function(error) {
                        console.warn('‚ö†Ô∏è Texture failed, keeping bright color');
                        updateEarthStatus('Sin textura - Color s√≥lido');
                        updateStatus('‚ö†Ô∏è 3D Earth sin textura (color s√≥lido)');
                    }
                );
                
                // Start animation
                animate();
                updateStatus('‚úÖ 3D Earth inicializado correctamente');
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                updateStatus(`‚ùå Error: ${error.message}`, true);
                updateEarthStatus(`Error: ${error.message}`);
            }
        }
        
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            if (earth) {
                earth.rotation.y += 0.02; // Faster rotation for visibility
            }
            
            if (renderer && camera && scene) {
                renderer.render(scene, camera);
            }
        }
        
        // Control functions
        function toggleLayer(layerId) {
            const layer = document.getElementById(layerId);
            if (layer.style.display === 'none') {
                layer.style.display = 'block';
            } else {
                layer.style.display = 'none';
            }
            updateLayerStatus();
        }
        
        function adjustEarthOpacity(opacity) {
            if (earth) {
                earth.material.transparent = opacity < 1.0;
                earth.material.opacity = opacity;
                earth.material.needsUpdate = true;
                updateEarthStatus(`Opacidad: ${(opacity * 100).toFixed(0)}%`);
            }
        }
        
        function changeEarthZIndex(zIndex) {
            const container = document.getElementById('earth3d-container');
            container.style.zIndex = zIndex;
            updateEarthStatus(`Z-Index: ${zIndex}`);
        }
        
        function updateLayerStatus() {
            const layers = ['layer-1', 'layer-2', 'layer-3', 'layer-opaque'];
            const visibleLayers = layers.filter(id => 
                document.getElementById(id).style.display !== 'none'
            );
            document.getElementById('layer-status').innerHTML = 
                `Capas visibles: ${visibleLayers.length}/${layers.length}`;
        }
        
        // Handle resize
        function handleResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth * 1.3, window.innerHeight * 1.3);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Ready - Iniciando diagn√≥stico');
            updateStatus('üöÄ DOM Ready, verificando Three.js...');
            
            // Check Three.js
            if (typeof THREE === 'undefined') {
                updateStatus('‚ùå Three.js no cargado', true);
                return;
            }
            
            updateStatus('‚úÖ Three.js cargado, inicializando diagn√≥stico...');
            setTimeout(init3DEarth, 100);
        });
        
        window.addEventListener('resize', handleResize);
        
        // Cleanup
        window.addEventListener('beforeunload', function() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });
        
        // Additional diagnostic info
        setTimeout(() => {
            console.log('üìä Informaci√≥n de diagn√≥stico:');
            console.log('- Window size:', window.innerWidth, 'x', window.innerHeight);
            console.log('- THREE.js version:', THREE.REVISION);
            console.log('- Earth container z-index:', getComputedStyle(document.getElementById('earth3d-container')).zIndex);
            
            const allElements = document.querySelectorAll('*');
            const elementsWithBackground = [];
            allElements.forEach(el => {
                const bg = getComputedStyle(el).backgroundColor;
                const zIndex = getComputedStyle(el).zIndex;
                if (bg !== 'rgba(0, 0, 0, 0)' && bg !== 'transparent') {
                    elementsWithBackground.push({
                        element: el.tagName + (el.id ? '#' + el.id : '') + (el.className ? '.' + el.className.split(' ').join('.') : ''),
                        background: bg,
                        zIndex: zIndex
                    });
                }
            });
            
            console.log('üé® Elementos con fondos:', elementsWithBackground);
        }, 2000);
    </script>
</body>
</html>
