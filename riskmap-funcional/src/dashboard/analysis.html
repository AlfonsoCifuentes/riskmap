<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <title>{{ translations['dashboard_title'] }} - Análisis Avanzado</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f4f6fa;padding:1rem}
        .container{max-width:1200px;margin:0 auto;background:#fff;padding:1rem;border-radius:8px;box-shadow:0 1px 4px #0001}
        h1{color:#1a237e;margin:0 0 1rem 0}
        #chart{width:100%;height:500px}
    </style>
</head>
<body>
<div class="container">
    <h1>Análisis histórico de víctimas (conflictos y desastres)</h1>
    <div id="chart_fatal">Loading…</div>
    <h2 style="margin-top:2rem">Correlación producción petróleo vs víctimas por conflictos</h2>
    <div id="chart_corr">Loading…</div>
</div>
<script>
// Víctimas anuales
fetch('/analysis_data').then(r=>r.json()).then(data=>{
  const years=data.map(d=>d.year);
  const fatalities=data.map(d=>d.fatalities);
  Plotly.newPlot('chart_fatal',[{x:years,y:fatalities,type:'bar',marker:{color:'#c62828'} }],
  {title:'Víctimas por año (últimos 100)',xaxis:{title:'Año'},yaxis:{title:'Fallecidos'}});
});

// Correlación petróleo vs víctimas
fetch('/analysis_energy_conflict').then(r=>r.json()).then(data=>{
  const years=data.map(d=>d.year);
  const oil=data.map(d=>d.oil_kbd);
  const fat=data.map(d=>d.fatalities);
  Plotly.newPlot('chart_corr',[
    {x:years,y:oil,name:'Oil kbd',yaxis:'y1',type:'scatter',mode:'lines',line:{color:'#1f77b4'}},
    {x:years,y:fat,name:'Fatalities',yaxis:'y2',type:'scatter',mode:'lines',line:{color:'#c62828'}}
  ],{
    title:'Petróleo (kbd) vs Fatalidades',
    xaxis:{title:'Año'},
    yaxis:{title:'Oil kbd',side:'left'},
    yaxis2:{title:'Fatalities',overlaying:'y',side:'right'}
  });
});
</script>
</body>
</html>