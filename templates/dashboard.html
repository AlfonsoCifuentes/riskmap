{% extends "layout.html" %}

{% block title %}Dashboard de Inteligencia Geopolítica{% endblock %}

{% block content %}
<!-- 3D Earth Wireframe Background -->
<div id="earth-wireframe">
    <div class="earth-container">
        <div class="earth-sphere">
            <!-- Lines are generated via CSS for performance -->
            <div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div><div class="wireframe-line lat-line"></div>
            <div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div><div class="wireframe-line lon-line"></div>
            <div class="orbital-ring"></div><div class="orbital-ring"></div>
            <div class="data-point" style="top: 25%; left: 15%;"></div><div class="data-point" style="top: 35%; left: 45%;"></div><div class="data-point" style="top: 45%; left: 75%;"></div><div class="data-point" style="top: 55%; left: 25%;"></div><div class="data-point" style="top: 65%; left: 65%;"></div>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 py-8">
    <!-- Stat Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-globe-americas text-4xl text-blue-400 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">Índice de Riesgo Global</div>
                <div id="global-risk-index" class="text-2xl font-bold">--</div>
            </div>
        </div>
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">Alertas Críticas</div>
                <div id="critical-alerts-count" class="text-2xl font-bold">--</div>
            </div>
        </div>
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-brain text-4xl text-purple-400 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">Confianza IA</div>
                <div id="ai-confidence" class="text-2xl font-bold">--%</div>
            </div>
        </div>
        <div class="glass-card p-6 flex items-center">
            <i class="fas fa-newspaper text-4xl text-green-400 mr-4"></i>
            <div>
                <div class="text-sm text-gray-400">Artículos (24h)</div>
                <div id="new-articles-count" class="text-2xl font-bold">--</div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Columna Principal -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Mapa de Calor de Riesgos -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Mapa de Calor de Riesgos</h2>
                </div>
                <div class="p-4">
                    <div id="map" class="h-96 rounded-lg bg-gray-800/50 border border-gray-700/50"></div>
                </div>
            </div>

            <!-- Análisis Periodístico por IA -->
            <div id="analysis" class="glass-card">
                 <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Análisis Periodístico por IA</h2>
                </div>
                <div id="ai-analysis-content" class="p-4 prose prose-invert max-w-none">
                    <!-- Contenido generado por IA se cargará aquí -->
                </div>
            </div>
        </div>

        <!-- Barra Lateral Derecha -->
        <div class="space-y-8">
            <!-- Eventos de Alto Riesgo -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Eventos de Alto Riesgo</h2>
                </div>
                <div id="high-risk-articles" class="p-4 max-h-96 overflow-y-auto">
                    <!-- Artículos de alto riesgo se cargarán aquí -->
                </div>
            </div>

            <!-- Artículos Recientes -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Artículos Recientes</h2>
                </div>
                <div id="recent-articles" class="p-4 max-h-96 overflow-y-auto">
                    <!-- Artículos recientes se cargarán aquí -->
                </div>
            </div>
            
            <!-- Gráficos de Tendencias -->
            <div id="reports" class="glass-card">
                <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Acciones del Sistema</h2>
                </div>
                <div class="p-4 space-y-4">
                    <button id="run-ingestion-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-rss mr-2"></i>Ejecutar Ingesta RSS
                    </button>
                    <button id="run-analysis-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-cogs mr-2"></i>Ejecutar Análisis NLP
                    </button>
                    <div id="actions-status" class="text-center text-sm text-gray-400 h-4"></div>
                </div>
            </div>
             <!-- Gráficos de Tendencias -->
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Tendencias de Riesgo</h2>
                </div>
                <div class="p-4">
                    <div id="risk-timeline-chart" class="h-48"></div>
                </div>
            </div>
            <div class="glass-card">
                <div class="p-4 border-b border-gray-700/50">
                    <h2 class="text-xl font-bold">Distribución de Riesgo</h2>
                </div>
                <div class="p-4">
                    <div id="risk-distribution-chart" class="h-48"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- Leaflet Heatmap Plugin -->
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <!-- Dashboard Logic -->
    <script src="/static/js/dashboard.js"></script>
{% endblock %}
